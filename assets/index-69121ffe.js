(function(){const Y=document.createElement("link").relList;if(Y&&Y.supports&&Y.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))ke(l);new MutationObserver(l=>{for(const v of l)if(v.type==="childList")for(const F of v.addedNodes)F.tagName==="LINK"&&F.rel==="modulepreload"&&ke(F)}).observe(document,{childList:!0,subtree:!0});function pt(l){const v={};return l.integrity&&(v.integrity=l.integrity),l.referrerpolicy&&(v.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?v.credentials="include":l.crossorigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function ke(l){if(l.ep)return;l.ep=!0;const v=pt(l);fetch(l.href,v)}})();function Gi(mt,Y,pt,ke){this._logo="https://mult-uroki.ru/media/pointjs/gamedev_4.png";var l=window,v=this,F=!1,Nt="fixed",Ue=0,qe=0,Ae=100,Ke=function(t){return t=t.getBoundingClientRect(),{y:t.top+l.pageYOffset,x:t.left+l.pageXOffset}},Di=function(t){for(var e=1;t;)e+=t.style.zIndex,t=t.offsetParent;return e};if(arguments.length===1){F=arguments[0];var Ve=Ke(F);Ue=Ve.x,qe=Ve.y,mt=F.offsetWidth,Y=F.offsetHeight,Nt="absolute",Ae=Di(F)}var Ft=!0,Me=!0,Ze=!0,ft=!1,zt=!0,y=mt,a=Y,xt=mt,gt=Y,R=y/2,J=a/2,wt=1,vt=1,h={x:0,y:0},P={fillStyle:"black",strokeStyle:"black",globalAlpha:1,font:"serif",textBaseline:"top"},ht=function(t){console.log("[PointJS] : ",t)};typeof POINTJS_USER_LOG<"u"&&(ht=POINTJS_USER_LOG);var Zt=function(t){var e=decodeURI(t.stack.toString().replace(/(@|[\(\)]|[\w]+:\/\/)/g,""));e=e.split(/\n/),e=(e[2]===""?e[0]:e[1]).split("/"),e=e[e.length-1].split(":"),ht('ERROR "'+t.toString()+`" 
 in      `+e[0]+` 
 line :   `+e[1]+` 
 symbol : `+e[2])};this.game={},this.levels={},this.camera={},this.keyControl={},this.mouseControl={},this.touchControl={},this.system={},this.vector={},this.math={},this.layers={},this.colors={},this.brush={},this.audio={},this.wAudio={},this.resources={},this.tiles={},this.OOP={},this.memory={},this.modules={},this.zList={},this.filters={},this.presets={},this.mmorpg={},this.system.log=ht,this.system.consoleLog=function(t){this.log=t===!0?console.log:ht},this.system.setTitle=function(t){l.document.title=t},this.system.setSettings=function(t){Ft=E(t.isShowError)?t.isShowError:!0,Me=E(t.isStopForError)?t.isStopForError:!0,Ze=E(t.isAutoClear)?t.isAutoClear:!1,E(t.isZBuffer)},this.system.setDefaultSettings=function(t){for(var e in t)P[e]=t[e];u.save()},this.system.setSmoothing=function(t){zt=t,u.msImageSmoothingEnabled=zt,u.imageSmoothingEnabled=zt},this.system.restart=function(t){l.location.reload(t)};var Ti={name:"PointJS",desc:"HTML5 Game Engine for JavaScript",author:"Александр Птичкин (multuroki@gmail.com)",version:"0.2.0.9"};this.system.getInfo=function(){return Ti},this.modules.import=function(t,e){T.add();var i=new XMLHttpRequest;i.open("GET",t,!0),i.onload=function(){var n={constructor:function(){}},o=i.responseText.toString().replace(/PointJS.Module/i,"Module.constructor");new Function("Module",o)(n),n=new n.constructor(v,l),T.load(),e(n)},i.send()},this.modules.importSync=function(t){try{var e=new XMLHttpRequest;e.open("GET",t,!1),e.send()}catch{return}return t={constructor:function(){}},e=e.responseText.toString().replace(/PointJS.Module/i,"Module.constructor"),new Function("Module",e)(t),new t.constructor(v,l)};var ut=function(t,e){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},ct=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};ct.prototype={abs:function(){return new ct(Math.abs(this.x),Math.abs(this.y),Math.abs(this.z))},invert:function(){return new ct(-this.x,-this.y,-this.z)},plus:function(t){return new ct(this.x+t.x,this.y+t.y,this.z+t.z)},minus:function(t){return new ct(this.x-t.x,this.y-t.y,this.z-t.z)},inc:function(t){return new ct(this.x*t.x,this.y*t.y,this.z*t.z)},div:function(t){return new ct(this.x/t.x,this.y/t.y,this.z/t.z)},int:function(){return new ct(this.x>>0,this.y>>0,this.z>>0)}};var r=function(t,e,i){return new ct(t,e,i)},M=function(t,e,i){return{w:t,h:e,d:i}},Qt=function(t,e){return{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}},B=function(t,e,i){if(i){var n=O(i);i=t.x-e.x,t=t.y-e.y;var o=Math.cos(n);return n=Math.sin(n),r(i*o-t*n+e.x,i*n+t*o+e.y)}return r(t.x,t.y)},Rt=function(t,e){return 180/Math.PI*Math.atan2(e.y-t.y,e.x-t.x)},Pt=function(t,e){var i,n=0,o=0,c=e.length;for(i=e.length-1;o<c;i=o++)e[o].y>t.y!=e[i].y>t.y&&t.x<(e[i].x-e[o].x)*(t.y-e[o].y)/(e[i].y-e[o].y)+e[o].x&&(n=!n);return n},Jt=function(t,e,i){return!(t<e||t>i)};this.vector.isNumInRange=Jt,this.vector.point=r,this.vector.simplePoint=function(t,e,i){return{x:t!==!1?t:!1,y:e!==!1?e:!1,z:i!==!1?i:!1}},this.vector.v2d=r,this.vector.size=M,this.vector.getPointAngle=B,this.vector.isPointIn=Pt,this.vector.pointMinus=function(t,e){return{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}},this.vector.pointPlus=Qt,this.vector.pointInc=function(t,e){return{x:t.x*e.x,y:t.y*e.y,z:t.z*e.z}},this.vector.pointDiv=function(t,e){return{x:t.x/(e.x!==0?e.x:1),y:t.y/(e.y!==0?e.y:1),z:t.z/(e.z!==0?e.z:1)}},this.vector.pointAbs=function(t){return{x:Math.abs(t.x),y:Math.abs(t.y),z:Math.abs(t.z)}},this.vector.getMidPoint=function(t,e){return E(e)?r((t.x+e.x)/2,(t.y+e.y)/2):0},this.vector.getDistance=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},this.vector.isSame=function(t,e){return E(e)?t.x===e.x&&t.y===e.y:!1},this.vector.getAngle2Points=Rt,this.vector.newStaticBox=function(t,e,i,n){return{x:t,y:e,w:i,h:n}},this.vector.newDynamicBoxRect=function(t,e,i,n){return[r(t,e),r(t+i,e),r(t+i,e+n),r(t,e+n)]},this.vector.moveCollision=function(t,e,i,n,o,c){var f=!1,d=!1,p=i.abs(),S=t.getStaticBoxPosition(),k=e.length-1,I,j=2+p.x;for(I=2+p.y;0<=k;k--)if(p=e[k],p.visible&&t!==p&&!(o&&!p.isInCameraStatic()||c&&t.getDistanceC(p.getPositionC())>c)&&t.isStaticIntersect(p.getStaticBox())){var L=p.getStaticBoxPosition();S.h>=L.y+I&&S.y<=L.h-I&&(0<=i.x?Jt(S.w,L.x,L.w)&&(t.x=L.x-(t.w+t.box.w+t.box.x)+1,i.x=0,f=!0):0>i.x&&Jt(S.x,L.x,L.w)&&(t.x=L.w-t.box.x-1,i.x=0,f=!0)),S.w>=L.x+j&&S.x<=L.w-j&&(0<i.y?Jt(S.h,L.y,L.h)&&(t.y=L.y-(t.h+t.box.h+t.box.y)+1,i.y=0,d=!0):0>i.y&&Jt(S.y,L.y,L.h)&&(t.y=L.h-t.box.y-1,i.y=0,d=!0)),n&&n(t,p,f,d)}t.move(i)},this.vector.moveCollisionAngle=function(t,e,i,n,o,c,f){var d=r();o=math.a2r(OOP.isDef(o)?o:t.angle),d.x=i*Math.cos(o),d.y=i*Math.sin(o),i=0,o=e.length;for(var p;i<o;i+=1)if(p=e[i],(!c||p.isInCamera())&&(!f||!t.getDistanceC(p.getPositionC()))){var S=p.getStaticBox();if(t.isIntersect(p)){var k=t.getStaticBox(),I=Math.abs(d.x),j=Math.abs(d.y);k.x+k.w>S.x+10+I&&k.x<S.x+S.w-10-I&&(0<d.y&&k.y+k.h<S.y+S.h/2+j||0>d.y&&k.y>S.y+S.h-S.h/2-j)&&(d.y=0),k.y+k.h>S.y+10+j&&k.y<S.y+S.h-10-j&&(0<d.x&&k.x+k.w<S.x+S.w/2+I||0>d.x&&k.x>S.x+S.w-S.w/2-I)&&(d.x=0),n&&n(t,p)}}return t.move(d),d};var Qe={},Oe=function(){var t=new Date().getTime();return Qe[t]&&(t=Oe()),Qe[t]=!0,t},O=function(t){return Math.PI/180*t},K=function(t,e,i){var n=Math.floor(Math.random()*(e-t+1)+t);return i&&n==0?K(t,e,i):n},St=function(t,e){var i=(St.canvas||(St.canvas=document.createElement("canvas"))).getContext("2d");return typeof e=="number"?i.font=e+"px serif":typeof e=="string"&&(i.font=e),i.measureText(t).width},De=function(t){return 0>t?-1:1};this.math.limit=function(t,e){var i=De(t);return t=Math.abs(t),e=Math.abs(e),t<e?t*i:e*i},this.math.sign=De,this.math.a2r=O,this.math.random=K,this.math.randomFY=function(t){for(var e=t.length-1;0<e;e--){var i=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[i],t[i]=n}return t},this.math.getTextWidth=St,this.math.toInt=function(t){return t>>0},this.math.uid=Oe,this.math.toZiro=function(t,e){if(t==0)return 0;var i=De(t);return e=Math.abs(e),t=Math.abs(t),0<t&&(t-=e,t<e)?0:t*i};var $e=function(t,e){return t||e||!1},Te=[],Ii=function(t,e){var i;this.canvas=i=l.document.createElement("canvas");var n=i.style,o=g.style;n.position=Nt,n.top=o.top,n.left=o.left,i.width=g.width,i.height=g.height,n.width=o.width,n.height=o.height,n.zIndex=o.zIndex+t,e&&(n.opacity=$e(e.alpha,1),n.backgroundColor=$e(e.backgroundColor,"transparent")),m.attach(i),(this.context=i.getContext("2d")).textBaseline=P.textBaseline,this.isAutoClear=!0,this.clear=function(){this.context.clearRect(0,0,y,a)},this.on=function(c){u=this.context,this.isAutoClear&&this.clear(),c(this),u=ei},this.setVisible=function(c){this.canvas.style=c?"block":"none"},Te.push(this)},Ct=function(){C(Te,function(t){t.canvas.width=y,t.canvas.height=a,t.canvas.style.width=g.style.width,t.canvas.style.height=g.style.height,t.context.textBaseline=P.textBaseline})},bi=function(){C(Te,function(t){t.canvas.style.left=g.style.left,t.canvas.style.top=g.style.top})};this.layers.newLayer=function(t,e){return new Ii(t,e)};var ti=0,m={loaded:!1,events:{onload:[],preLoop:[],postLoop:[],entryLoop:[],exitLoop:[],gameBlur:[],gameFocus:[],gameResize:[],gameStop:[],gameStart:[]},addEvent:function(t,e,i){t==="onload"&&m.loaded?i():m.events[t].push({id:e,func:i})},delEvent:function(t,e){C(m.events[t],function(i,n,o){i.id===e&&o.splice(n,1)})},runEvent:function(t){C(m.events[t],function(e){typeof e.func=="function"&&e.func()})},attach:function(t){var e=function(){l.document.body.appendChild(t)};m.loaded?e():m.addEvent("onload","attachElement_PointJS"+(ti+=1),e)},remove:function(t){var e=function(){l.document.body.removeChild(t)};m.loaded?e():m.addEvent("onload","attachElement_PointJS"+(ti+=1),e)},getWH:function(){return{w:parseInt(l.innerWidth||l.document.body.clientWidth),h:parseInt(l.innerHeight||l.document.body.clientHeight)}}};this.system.delEvent=function(t,e){m.delEvent(t,e)},this.system.addEvent=function(t,e,i){m.addEvent(t,e,i)},this.system.removeDOM=function(t){m.remove(t)},this.system.attachDOM=function(t){m.attach(t)},this.system.newDOM=function(t,e){var i=l.document.createElement(t);if(i.style.position=Nt,i.style.left=0,i.style.top=0,i.style.zIndex=w.style.zIndex+1,e){var n=function(o){o.stopPropagation()};i.addEventListener("touchstart",n,!1),i.addEventListener("touchend",n,!1),i.addEventListener("touchmove",n,!1),i.addEventListener("mousedown",n,!1),i.addEventListener("mousepress",n,!1),i.addEventListener("mouseup",n,!1),i.addEventListener("mousemove",n,!1),i.addEventListener("keypress",n,!1),i.addEventListener("keydown",n,!1),i.addEventListener("keyup",n,!1),i.addEventListener("click",n,!1),i.addEventListener("wheel",n,!1),i.addEventListener("mousewheel",n,!1),i.addEventListener("contextmenu",n,!1),i.addEventListener("selectstart",n,!1),i.addEventListener("dragstart",n,!1),i.addEventListener("DOMMouseScroll",n,!1)}return m.attach(i),i};var u=null,ei=null,Bt=r(Ue,qe),g=l.document.createElement("canvas");if(ei=u=g.getContext("2d"),u.textBaseline=P.textBaseline,g.crossOrigin="anonymous",g.width=parseInt(mt),g.height=parseInt(Y),g.style.position=Nt,F?(g.style.left=Bt.x+"px",g.style.top=Bt.y+"px",m.addEvent("gameResize","initedCanvasResize",function(){var t=Ke(F);v.system.setOffset(t.x,t.y),v.system.resize(F.offsetWidth,F.offsetHeight)})):(g.style.left=0,g.style.top=0),g.style.zIndex=Ae,g.id="PointJS-canvas_0",typeof pt=="object")for(var Ie in pt)Ie.match(/margin|padding|position/)||(g.style[Ie]=pt[Ie]);this.system.setOffset=function(t,e){w.style.left=g.style.left=t+"px",w.style.top=g.style.top=e+"px",Bt={x:t,y:e},bi()};var w=l.document.createElement("div");(function(){var t=w.style;t.position=Nt,t.left=g.style.left,t.top=g.style.top,t.width=g.width+"px",t.height=g.height+"px",t.zIndex=Ae+100})(),m.attach(w),m.attach(g),this.system.setStyle=function(t){if(typeof t=="object")for(var e in t)g.style[e]=t[e]},this.system.getCanvas=function(){return g},this.system.getContext=function(){return u},this.system.setContext=function(t){t&&(u=t)},this.system.resize=function(t,e){y=t||xt,a=e||gt,R=y/2,J=a/2,g.width=y,g.height=a,w.style.width=y+"px",w.style.height=a+"px",Ct()},this.system.initFullPage=function(){F||(m.addEvent("gameResize","PointJS_resizeGame",function(){y=m.getWH().w,a=m.getWH().h,R=y/2,J=a/2,g.width=y,g.height=a,u.textBaseline=P.textBaseline,w.style.width=y+"px",w.style.height=a+"px",Ct()}),m.runEvent("gameResize","PointJS_resizeGame"))};var et=!1,Li=function(){et||(this.requestFullscreen?(this.requestFullscreen(),et=!0):this.mozRequestFullScreen?(this.mozRequestFullScreen(),et=!0):this.webkitRequestFullscreen&&(this.webkitRequestFullscreen(),et=!0),y=m.getWH().w,a=m.getWH().h,R=y/2,J=a/2,g.width=y,g.height=a,w.style.width=y+"px",w.style.height=a+"px",Ct())},be=function(t){et=li(l.document.fullscreenElement||l.document.mozFullScreenElement||l.document.webkitFullscreenElement)};l.document.addEventListener("webkitfullscreenchange",be),l.document.addEventListener("mozfullscreenchange",be),l.document.addEventListener("fullscreenchange",be),this.system.initFullScreen=function(){F||et||(l.document.documentElement.onclick=Li,jt||(m.addEvent("gameResize","PointJS_initFullScreen",function(){y=m.getWH().w,a=m.getWH().h,R=y/2,J=a/2,g.width=y,g.height=a,u.textBaseline=P.textBaseline,w.style.width=y+"px",w.style.height=a+"px",Ct()}),m.runEvent("gameResize","PointJS_initFullScreen")))},this.system.exitFullScreen=function(){et&&(m.delEvent("gameResize","PointJS_initFullScreen"),l.document.exitFullscreen?(l.document.exitFullscreen(),et=!1):l.document.mozCancelFullScreen?(l.document.mozCancelFullScreen(),et=!1):l.document.webkitExitFullscreen&&(l.document.webkitExitFullscreen(),et=!1),y=xt,a=gt,R=y/2,J=a/2,g.width=y,g.height=a,w.style.width=y+"px",w.style.height=a+"px",Ct(),l.document.documentElement.onclick=function(){})},this.system.isFullScreen=function(){return et},this.system.exitFullPage=function(){m.delEvent("gameResize","PointJS_resizeGame"),y=xt,a=gt,R=y/2,J=a/2,g.width=y,g.height=a,w.style.width=y+"px",w.style.height=a+"px",Ct()};var it=!1,jt=!1,ii=xt,ni=gt,si=!1;this.system.initFullScale=function(t){F||jt||(t&&(si=!0),m.addEvent("gameResize","PointJS_initFullScale",function(){var e=ii,i=ni,n=m.getWH();si?(e=n.w,i=n.h):n.w<n.h?(i=n.w/y,e=n.w,i*=a):n.h<n.w&&(e=n.h/a,i=n.h,e*=y),ii=e,ni=i,it={w:e/y,h:i/a},g.style.width=e+"px",g.style.height=i+"px",w.style.width=e+"px",w.style.height=i+"px",Ct()}),m.runEvent("gameResize","PointJS_initFullScale"),jt=!0)},this.system.exitFullScale=function(){jt&&(jt=!1,m.delEvent("gameResize","PointJS_initFullScale"),g.style.width=xt+"px",g.style.height=gt+"px",w.style.width=xt+"px",w.style.height=gt+"px")},this.system.getWH=function(){return m.getWH()};var Le=!1,$t={LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,CTRL:17,SHIFT:16,ALT:18,ESC:27,ENTER:13,MINUS:189,PLUS:187,CAPS_LOCK:20,BACKSPACE:8,TAB:9,DELETE:46,Q:81,W:87,E:69,R:82,T:84,Y:89,U:85,I:73,O:79,P:80,A:65,S:83,D:68,F:70,G:71,H:72,J:74,K:75,L:76,Z:90,X:88,V:86,B:66,N:78,M:77,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,C:67,9:57,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},Tt={37:"LEFT",39:"RIGHT",38:"UP",40:"DOWN",32:"SPACE",17:"CTRL",16:"SHIFT",18:"ALT",27:"ESC",13:"ENTER",189:"MINUS",187:"PLUS",20:"CAPS_LOCK",8:"BACKSPACE",9:"TAB",46:"DELETE",81:"Q",87:"W",69:"E",82:"R",84:"T",89:"Y",85:"U",73:"I",79:"O",80:"P",65:"A",83:"S",68:"D",70:"F",71:"G",72:"H",74:"J",75:"K",76:"L",90:"Z",88:"X",86:"V",66:"B",78:"N",77:"M",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",67:"C",57:"9",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12"},Ni={8:!0,9:!0,13:!0,18:!0,16:!0,17:!0,27:!0,112:!0,113:!0,114:!0,115:!0,116:!0,117:!0,118:!0,119:!0,120:!0,121:!0,122:!0,123:!0};this.keyControl.getKeyList=function(){var t,e=[];for(t in $t)e.push(t);return e};var nt={},Yt={},Et={},Wt=!1,Gt=!1,te=!1,ee=!1,Fi=function(t){N(Et,function(e,i,n){e==1&&(n[i]=2)})};this.keyControl.getCountKeysDown=function(){var t=0;return N(nt,function(e,i){e&&t++}),t},this.keyControl.getAllKeysDown=function(){var t=[];return N(nt,function(e,i){e&&t.push(Tt[i])}),t},this.keyControl.getLastKeyPress=function(){return ee?Tt[ee]:!1},this.keyControl.isDown=function(t){return nt[$t[t]]==1},this.keyControl.isUp=function(t){return Yt[$t[t]]==1},this.keyControl.isPress=function(t){return Et[$t[t]]==1},this.keyControl.getInputChar=function(){return Wt},this.keyControl.getInputKey=function(){return Tt[Gt]},this.keyControl.setInputMode=function(t){te=t},this.keyControl.isInputMode=function(){return te},this.keyControl.exitKeyControl=function(){l.onkeydown=function(){},l.onkeypress=function(){},l.onkeyup=function(){},D.clear("key:down"),D.clear("key:press"),D.clear("key:up"),m.delEvent("postLoop","PointJS_clearAllKeyUp"),m.delEvent("preLoop","PointJS_KeyDownEvent"),nt={},Yt={},Et={},Le=te=Gt=Wt=!1},this.keyControl.initControl=this.keyControl.initKeyControl=function(){return Le?this:(Le=!0,l.onkeydown=function(t){return te?(Gt=t.keyCode,Ni[t.keyCode]?(t.preventDefault(),!1):!0):(t.preventDefault(),Et[t.keyCode]!=2&&(Et[t.keyCode]=1,ee=t.keyCode,D.run("key:press",Tt[t.keyCode])),nt[t.keyCode]=!0,!1)},l.onkeypress=function(t){var e=!1;t.which!=0&&t.charCode!=0&&32<=t.which&&(e=String.fromCharCode(t.which)),Wt=e},l.onkeyup=function(t){return t.preventDefault(),nt[t.keyCode]==1&&(Yt[t.keyCode]=!0),nt[t.keyCode]=!1,D.run("key:up",Tt[t.keyCode]),delete Et[t.keyCode],delete nt[t.keyCode],!1},m.addEvent("postLoop","PointJS_clearAllKeyUp",function(){Yt={},Fi(),ee=Gt=Wt=!1}),m.addEvent("preLoop","PointJS_KeyDownEvent",function(){D.isEvent("key:down")&&N(nt,function(t,e){t&&D.run("key:down",Tt[e])})}),this)};var _t=!1,z=r(0,0),ie=r(0,0);r(0,0);var Xt=!0,ne="",se=!1,kt=r(0,0),oe=!1,Ne={LEFT:1,RIGHT:3,MIDDLE:2},Fe={1:"LEFT",3:"RIGHT",2:"MIDDLE"},re=!1,he={},ue={},Ht={},It=0,oi=function(){he={},ue={},Ht={},It=0,oe=!1},zi=function(){N(Ht,function(t,e,i){t==1&&(i[e]=2)})},ce=function(t){var e=0,i=0;return t&&(e=h.x,i=h.y),r(e+z.x,i+z.y)};this.mouseControl.getPosition=function(){return ce(1)},this.mouseControl.getPositionS=function(){return ce()},this.mouseControl.setCursorImage=function(t){if(t="url('"+t+"'), auto",ne!==t)return ne=t,l.document.body.style.cursor=ne},this.mouseControl.setVisible=function(t){!Xt&&!t||Xt&&t||(Xt=t==1,l.document.body.style.cursor=Xt?ne:"none")},this.mouseControl.isVisible=function(){return Xt},this.mouseControl.isDown=function(t){return he[Ne[t]]},this.mouseControl.isUp=function(t){return ue[Ne[t]]},this.mouseControl.isPress=function(t){return Ht[Ne[t]]==1},this.mouseControl.isMove=function(){return oe},this.mouseControl.isInStatic=function(t){var e=ce(1);return e.x>=t.x&&e.x<=t.x+t.w&&e.y>=t.y&&e.y<=t.y+t.h},this.mouseControl.isInDynamic=function(t){return Pt(ce(1),t)},this.mouseControl.isInObject=function(t){return t.visible?t.angle?this.isInDynamic(t.getDynamicBox()):this.isInStatic(t.getStaticBox()):!1},this.mouseControl.isWheel=function(t){return t==="UP"&&0<It||t==="DOWN"&&0>It};var ri=function(t){return t.preventDefault(),It=t.wheelDelta?t.wheelDelta:-t.detail,D.run("mouse:wheel",0>It?"DOWN":"UP"),!1},le=!1,hi=function(){le&&(se=!!(E(l.document.pointerLockElement)||E(l.document.mozPointerLockElement)))};this.mouseControl.initMouseLock=function(){m.addEvent("onload","initPointerLock",function(){if(le=w.requestPointerLock||w.mozRequestPointerLock||!1,l.document.exitPointerLock=l.document.exitPointerLock||l.document.mozExitPointerLock||!1,"onpointerlockchange"in l.document?l.document.addEventListener("pointerlockchange",hi,!1):"onmozpointerlockchange"in l.document&&l.document.addEventListener("mozpointerlockchange",hi,!1),!le)return ht("error in initMouseLock : not supported");se||(w.onclick=le)})},this.mouseControl.exitMouseLock=function(){l.document.exitPointerLock(),w.onclick=function(){},kt=r(0,0)},this.mouseControl.unlockMouse=function(){kt=r(0,0),l.document.exitPointerLock()},this.mouseControl.isMouseLock=function(){return se},this.mouseControl.getSpeed=function(){return r(kt.x,kt.y)},this.mouseControl.isPeekStatic=function(t,e){return this.isPress(t)?this.isInStatic(e):!1},this.mouseControl.isPeekDynamic=function(t,e){return this.isPress(t)?this.isInDynamic(e):!1},this.mouseControl.isPeekObject=function(t,e){return this.isPress(t)&&e.visible?this.isInDynamic(e.getDynamicBox()):!1},this.mouseControl.initControl=this.mouseControl.initMouseControl=function(){return _t?this:(_t=!0,w.onmousemove=function(t){if(t.preventDefault(),t.stopPropagation(),se){var e=t.movementY||t.mozMovementY||0;z.x+=t.movementX||t.mozMovementX||0,z.y+=e}else z.x=t.pageX-Bt.x,z.y=t.pageY-Bt.y,it&&(z.x/=it.w,z.y/=it.h);return z.x/=wt,z.y/=vt,kt.x=z.x-ie.x,kt.y=z.y-ie.y,ie.x=z.x,ie.y=z.y,D.run("mouse:move"),oe=!0,!1},w.onmousedown=function(t){t.preventDefault(),t.stopPropagation(),!t.which&&t.button&&(t.button&1?t.which=1:t.button&4?t.which=2:t.button&2&&(t.which=3)),D.run("mouse:press",Fe[t.which]),re=Fe[t.which],he[t.which]=!0,Ht[t.which]=1},w.onmouseup=function(t){t.preventDefault(),t.stopPropagation(),!t.which&&t.button&&(t.button&1?t.which=1:t.button&4?t.which=2:t.button&2&&(t.which=3)),D.run("mouse:up",Fe[t.which]),re=!1,he[t.which]=!1,ue[t.which]=!0,delete Ht[t.which]},w.oncontextmenu=w.onselectstart=w.ondragstart=function(){return!1},w.onmousewheel=ri,w.addEventListener("DOMMouseScroll",ri,!1),m.addEvent("preLoop","PointJS_MouseEventDown",function(){re&&D.run("mouse:down",re)}),m.addEvent("postLoop","PointJS_clearAllMouseUp",function(){ue={},zi(),It=0,oe=!1,kt=r(0,0)}),this)},this.mouseControl.exitMouseControl=function(){D.clear("mouse:press"),D.clear("mouse:down"),D.clear("mouse:up"),D.clear("mouse:move"),D.clear("mouse:wheel"),w.onmousemove=w.onmousedown=w.onmouseup=w.oncontextmenu=w.onselectstart=w.ondragstart=w.onmousewheel=function(){},m.delEvent("postLoop","PointJS_clearAllMouseUp"),m.delEvent("preLoop","PointJS_MouseEventDown"),oi(),_t=!1};var ze=!1,Ut=!1,fe=0,ye=0,W=0,G=0,A=r(0,0),ae=[],qt=r(0,0),de=r(0,0);this.touchControl.isTouchSupported=function(){return"ontouchstart"in window},this.touchControl.isMobileDevice=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(l.navigator.userAgent)};var ui=function(){Ut=!1,ye=fe=0,A=r(0,0),ae=[],G=W=0};this.touchControl.getFixPositionS=function(){return A.x||A.y?r(A.x,A.y):!1},this.touchControl.getFixPosition=function(){return A.x||A.y?r(A.x+h.x,A.y+h.y):!1},this.touchControl.getRun=function(){var t=0,e=0;return A.x&&A.x!=W&&(t=W-A.x),A.y&&A.y!=G&&(e=G-A.y),r(t,e)},this.touchControl.getVector=function(){var t=0,e=0;return A.x&&A.x!=W&&(t=W>A.x?1:-1),A.y&&A.y!=G&&(e=G>A.y?1:-1),r(t,e)},this.touchControl.getSpeed=function(){return r(qt.x,qt.y)},this.touchControl.isDown=function(){return Ut},this.touchControl.isPress=function(){return fe==1},this.touchControl.isUp=function(){return ye==1},this.touchControl.getPosition=function(){return r(W+h.x,G+h.y)},this.touchControl.getPositionS=function(){return r(W,G)},this.touchControl.isPeekStatic=function(t){return this.isPress()?this.isInStatic(t):!1},this.touchControl.isPeekDynamic=function(t){return this.isPress()?this.isInDynamic(t):!1},this.touchControl.isPeekObject=function(t){return this.isPress()&&t.visible?this.isInDynamic(t.getDynamicBox()):!1},this.touchControl.isInStatic=function(t){var e=this.getPosition();return e.x>=t.x&&e.x<=t.x+t.w&&e.y>=t.y&&e.y<=t.y+t.h},this.touchControl.isInDynamic=function(t){return Pt(this.getPosition(),t)},this.touchControl.isInObject=function(t){return t.visible?t.angle?this.isInDynamic(t.getDynamicBox()):this.isInStatic(t.getStaticBox()):!1},this.touchControl.getTouches=function(){return ae},this.touchControl.initControl=this.touchControl.initTouchControl=function(){return ze?this:(ze=!0,l.addEventListener("touchstart",function(t){return t.preventDefault(),W=t.targetTouches[0].pageX,G=t.targetTouches[0].pageY,ae=t.targetTouches,it&&(W/=it.w,G/=it.h),D.run("touch:press"),A.x=W,A.y=G,Ut=!0,fe=1,!1},{passive:!1}),l.addEventListener("touchmove",function(t){return W=t.targetTouches[0].pageX,G=t.targetTouches[0].pageY,ae=t.targetTouches,it&&(W/=it.w,G/=it.h),qt.x=W-de.x,qt.y=G-de.y,D.run("touch:move"),!1},!1),l.addEventListener("touchend",function(t){return A.x=0,A.y=0,Ut=!1,ye=1,D.run("touch:up"),!1},!1),v.touchControl.vibrate=function(t){if(l.navigator.vibrate)return l.navigator.vibrate(t);if(l.navigator.oVibrate)return l.navigator.oVibrate(t);if(l.navigator.mozVibrate)return l.navigator.mozVibrate(t);if(l.navigator.webkitVibrate)return l.navigator.webkitVibrate(t)},m.addEvent("preLoop","PointJS_TouchDownEvent",function(){Ut&&D.run("touch:down")}),m.addEvent("postLoop","PointJS_touchStopPress",function(){ye=fe=0,de.x=W,de.y=G,qt=r(0,0)}),this)},this.touchControl.exitTouchControl=function(){l.ontouchstart=l.ontouchmove=l.ontouchend=function(t){},m.delEvent("postLoop","PointJS_touchStopPress"),m.delEvent("preLoop","PointJS_TouchDownEvent"),ui(),ze=!1};var me=function(t,e,i,n){return n?"rgba("+t+", "+e+", "+i+", "+n+")":"rgb("+t+", "+e+", "+i+")"},ci=function(t,e){t=t[0]==="#"?t.substr(1,6):t;var i=parseInt(t.substr(0,2),16),n=parseInt(t.substr(2,2),16),o=parseInt(t.substr(4,2),16);return me(i,n,o,e)};this.colors.rgb=function(t,e,i){return me(t,e,i)},this.colors.rgba=function(t,e,i,n){return me(t,e,i,n)},this.colors.hex2rgb=function(t){return ci(t)},this.colors.hex2rgba=function(t,e){return ci(t,e)},this.colors.randomColor=function(t,e,i){return me(K(t,e),K(t,e),K(t,e),i||1)},this.colors.fromImage=function(t,e,i,n,o){var c={img:l.document.createElement("img"),color:null};return c.img.onload=function(){var f=l.document.createElement("canvas");f.width=n||this.width,f.height=o||this.height,f.getContext("2d").drawImage(this,0,0,f.width,f.height),c.color=u.createPattern(f,e),typeof i=="function"&&(c.onload=i,c.onload(),delete c.onload)},c.img.src=t,c};var E=function(t){return!(typeof t>"u"||t==null)},li=function(t){return!!(E(t)&&t!==""&&t!==0)},N=function(t,e,i){var n,o;for(n in t)if((!i||t.hasOwnProperty(n))&&typeof t[n]<"u"&&(o=e(t[n],n,t))&&o==="break")break},C=function(t,e){if(t.length)for(var i=t.length-1,n;0<=i&&(typeof t[i]>"u"||!(n=e(t[i],i,t)||!1)||n!=="break");i--);};this.OOP.extractArrElement=function(t,e){var i=t[e];return t.splice(e,1),i},this.OOP.extractRandArrElement=function(t){var e=K(0,t.length-1),i=t[e];return t.splice(e,1),i},this.OOP.drawEach=function(t,e){N(t,function(i){i&&i.draw&&i.isInCamera()&&(i.draw(),e&&e(i))})},this.OOP.drawArr=function(t,e){var i,n=0;for(i=t.length;n<i;n+=1)t[n]&&t[n].draw&&t[n].isInCamera()&&(t[n].draw(),e&&e(t[n],n))},this.OOP.getArrInCamera=function(t){var e=[];return C(t,function(i){i.isInCamera()&&e.push(i)}),e},this.OOP.getArrOutCamera=function(t){var e=[];return C(t,function(i){i.isInCamera()||e.push(i)}),e};var fi=function(t){t.length=0},Ri=function(t,e){var i=!1,n=Oe(),o=!1,c=new XMLHttpRequest,f=function(){c.open("GET",t,!0),c.send()};c.onreadystatechange=function(){c.readyState==4&&(e(c.responseText),i&&(o?setTimeout(f,o):f()))},this.start=function(){t=t.match(/\?/)?t+("&session_id="+n):t+("?session_id="+n),f(),i=!0},this.setSID=function(d){n=d},this.setTime=function(d){o=d},this.stop=function(){i=!1},this.isActive=function(){return i}};this.OOP.readJSON=function(t,e,i){var n={},o=new XMLHttpRequest;o.open("GET",t,!0),T.add(),o.onreadystatechange=function(){o.readyState==4&&(n=o.responseText,i||(n=JSON.parse(n)),T.load(),e(n))},o.send()},this.OOP.toString=function(t,e){var i,n=0,o="[";for(i in t)if(t.hasOwnProperty(i)){var c=t[i];typeof c=="number"&&e&&(c=parseInt(c)),o+=(0<n?", ":"")+i+" : "+c,n+=1}return o+"]"},this.OOP.sendGET=function(t,e,i){var n=new XMLHttpRequest,o="?";N(e,function(c,f){o+=f+"="+encodeURIComponent(c)+"&"}),n.open("GET",t+o,!0),n.onreadystatechange=function(){n.readyState==4&&i(n.responseText)},n.send()},this.OOP.sendPOST=function(t,e,i){var n=new XMLHttpRequest,o="";N(e,function(c,f){o+=f+"="+encodeURIComponent(c)+"&"}),n.open("POST",t,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){n.readyState==4&&i(n.responseText)},n.send(o)},this.OOP.sendPOSTScreen=function(t,e,i){var n=new XMLHttpRequest;e=e+"="+g.toDataURL("image/png"),n.open("POST",t,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){n.readyState==4&&i(n.responseText)},n.send(e)},this.OOP.isDef=E,this.OOP.isSet=li,this.OOP.forEach=N,this.OOP.forInt=function(t,e){var i,n;for(i=0;i<t&&(!(n=e(i))||n!="break");i+=1);},this.OOP.forXY=function(t,e,i){var n,o,c;for(o=0;o<e;o+=1)for(n=0;n<t&&(!(c=i(n,o))||c!="break");n+=1);},this.OOP.forArr=C,this.OOP.clearArr=fi,this.OOP.fillArr=function(t,e,i){t.length=0;var n;for(n=0;n<e;n+=1)t.push(i(n,0<n?t[n-1]:!1));return t},this.OOP.delObject=function(t,e){var i,n=0;for(i=t.length;n<i;n+=1)if(t[n]==e)return t.splice(n,1),!0},this.OOP.randArrElement=function(t){return t[K(0,t.length-1)]},this.OOP.readJSONSync=function(t){var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(),t=e.responseText,t=JSON.parse(t)},this.OOP.sendGETSync=function(t,e){var i=new XMLHttpRequest,n="?";return N(e,function(o,c){n+=c+"="+encodeURIComponent(o)+"&"}),i.open("GET",t+n,!1),i.send(),i.responseText},this.OOP.sendPOSTSync=function(t,e){var i=new XMLHttpRequest,n="";return N(e,function(o,c){n+=c+"="+encodeURIComponent(o)+"&"}),i.open("POST",t,!1),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(n),i.responseText},this.OOP.newAJAXListener=function(t,e){return new Ri(t,e)},this.OOP.runCode=function(t){new Function("",t)()};var _={};this.OOP.includeSync=function(t,e){if(_[t])_[t].loaded&&!e&&_[t].code();else{_[t]={loaded:!1,code:function(){console.log(t+" is loading")}};var i=new XMLHttpRequest;i.open("GET",t,!1),i.send(),_[t].code=new Function("",i.responseText),_[t].loaded=!0,_[t].code()}},this.OOP.include=function(t,e,i){if(_[t])_[t].loaded&&!i&&_[t].code(),e&&e();else{_[t]={loaded:!1,code:function(){console.log(t+" is loading")}};var n=new XMLHttpRequest;n.open("GET",t,!0),n.onreadystatechange=function(){n.readyState===4&&(_[t].code=new Function("",n.responseText),_[t].loaded=!0,_[t].code(),e&&e())},n.send()}},this.OOP.clone=function(t,e){var i=gi(t);return N(t,function(n,o){["id","type","anim"].indexOf(o)===-1&&(i[o]=n)}),e&&(i.onClone=e,i.onClone(i),delete i.onClone),i};var Ji=function(){var t=[];this.fillFromArr=function(e){t.length=0,C(e,function(i){t.push(i)})},this.fill=function(e,i){t.length=0,v.OOP.fillArr(t,e,i)},this.draw=function(e){for(var i=t.length-1;0<=i;i--)t[i].isInCamera()&&(t[i].draw(),e&&e(t[i],i))},this.update=function(e,i){for(var n=t.length-1;0<=n;n--)i&&!t[n].isInCamera()||e(t[n],n)},this.add=function(e){t.push(e)},this.del=function(e){v.OOP.delObject(t,e)}};this.OOP.newGroup=function(){return new Ji};var Kt=60,X=Date.now(),pe=0,xe=-1,yi=X,yt={},ge=0;this.game.setFPS=function(t){Kt=0<t?t:60},this.game.getDT=function(t){return t||(t=1e3),pe/t},this.game.getTime=function(){return X};var ai=function(){return l.requestAnimationFrame||l.webkitRequestAnimationFrame||l.mozRequestAnimationFrame||l.oRequestAnimationFrame||l.msRequestAnimationFrame||function(t){l.setTimeout(t,1e3/Kt)}},bt=ai(),di=function(){X=Date.now(),Ze&&u.clearRect(0,0,y,a),m.runEvent("preLoop")},mi=function(){m.runEvent("postLoop"),xe!==-1&&(pe=X-xe),xe=X},H={func:function(){console.log('please, use a "setLoop" function.'),bt=function(){}},events:!1,start:!1,end:!1,audio:!1,fps:!1,name:"NotLoop"},pi=function(){H.audio&&C(H.audio,function(t){t.stop()})};this.game.newLoop=function(t,e,i,n,o){typeof e=="function"?yt[t]={events:o||!1,func:e,start:i||!1,end:n||!1,audio:!1,fps:!1,name:t}:at("error in newLoop : "+e+" is not a function")},this.game.newLoopFromClassObject=function(t,e){if(!e.update)return at('error in newLoopFromClassObject : function "update" not found');yt[t]={events:e.events||!1,func:e.update,start:e.entry||!1,end:e.exit||!1,audio:!1,fps:!1,name:t}},this.game.newLoopFromConstructor=function(t,e){v.game.newLoopFromClassObject(t,new e)},this.game.setLoopSound=function(t,e){var i;for(yt[t].audio||(yt[t].audio=[]),i=0;i<e.length;i+=1)yt[t].audio.length=0,e[i].setNextPlay(e[i+1===e.length?0:i+1]),yt[t].audio.push(e[i])},this.game.setLoop=function(t){if(!yt[t])return at("setLoop : "+t+" is no a Loop");pi(),oi(),nt={},Yt={},Et={},Gt=Wt=!1,ui(),Xe(r(0,0)),H.end&&H.end(),m.runEvent("exitLoop"),H=yt[t],D.loadFromEvents(H.events),H.start&&H.start(),m.runEvent("entryLoop"),H.audio&&H.audio[0].play()};var D=new function(){var t={"mouse:click":[]},e=this;this.add=function(i,n){t[i]||(t[i]=[]),t[i].push(n)},this.run=function(i,n){t[i]&&C(t[i],function(o){return o(n)})},this.clear=function(i){t[i]&&(t[i].length=0)},this.clearAll=function(){N(t,function(i){i.length=0})},this.loadFromEvents=function(i){e.clearAll(),i&&N(i,function(n,o){e.add(o,n)})},this.isEvent=function(i){return!!t[i]}};this.game.tick=function(t,e){ge===t&&e()};var we={};this.game.skip=function(t,e,i){E(we[t])||(we[t]=0),we[t]++>=e&&(i(),we[t]=0)};var Re=function(){if(60>ge?ge++:ge=0,60>Kt){var t=1e3/Kt;try{X=Date.now(),X-yi>t&&(di(),H.func(pe),yi=X,mi())}catch(e){Ft&&Zt(e),Me&&(Ft||Zt(e),at())}return bt(Re),!1}try{di(),H.func(pe),mi()}catch(e){Ft&&Zt(e),Me&&(Ft||Zt(e),at())}bt(Re)},xi=function(t){ft||(ft=!0,Kt=t||60,bt(Re),m.runEvent("gameStart"))},at=function(t){ft&&(ft=!1,pi(),bt=function(){typeof t<"u"&&ht(t)},m.runEvent("gameStop"))};this.game.isStopped=function(){return!ft},this.game.getWH=function(){return{w:y,h:a,w2:R,h2:J}},this.game.getWH2=function(){return{w:R,h:J}},this.game.getResolution=function(){return Math.min(y/xt,a/gt)},this.game.startLoop=function(t,e){this.setLoop(t),this.start(e)},this.game.start=xi,this.game.stop=at,this.game.resume=function(){if(!ft)return H.audio&&H.audio[0].play(),bt=ai(),xe=-1,xi(),!1};var Bi=0,b=function(t){this.type="BaseObject",this.id=Bi+=1,this.x=t.x||0,this.y=t.y||0,this.w=t.w||0,this.h=t.h||0,this.ondraw=t.ondraw?t.ondraw:!1,typeof t.predraw=="function"&&(this.predraw=t.predraw),this.parent=!1,this.children=[],this.fillColor=t.fillColor||!1,this.strokeColor=t.strokeColor||P.strokeStyle,this.strokeWidth=t.strokeWidth||0,this.angle=t.angle||0,this.alpha=E(t.alpha)?t.alpha:1,this.center=r(0,0),this.box={x:0,y:0,w:0,h:0},this.visible=E(t.visible)?t.visible:!0,this.flip=r(0,0),this.__dataset__={},this.setShadow(t),typeof t.data=="object"&&N(t.data,function(e,i){this.dataSet(i,e)},!0),t.userData&&this.setUserData(t.userData),t.center&&this.setCenter(t.center),t.box&&this.setBox(t.box),t.size&&this.setSize(t.size),t.sizeC&&this.setSizeC(t.sizeC),t.position&&this.setPosition(t.position),t.positionC&&this.setPositionC(t.positionC),typeof t.oncreate=="function"&&(this.oncreate=t.oncreate,this.oncreate(this),delete this.oncreate)};b.prototype={predraw:function(){},getID:function(){return this.id},getType:function(){return this.type},dataDel:function(t){delete this.__dataset__[t]},dataSet:function(t,e){this.__dataset__[t]=e},dataGet:function(t,e){return typeof this.__dataset__[t]<"u"?this.__dataset__[t]:typeof e<"u"?e:!1},data:function(){return this.__dataset__},getParent:function(){return this.parent},addChild:function(t){t&&t.id!=this.id&&(t.parent=this,this.children.push(t),t.move(this.getPosition()),t.setPositionC(B(t.getPositionC(),this.getPositionC(),this.angle)),t.turn(this.angle))},delChild:function(t){t.parent=!1;var e,i=0;for(e=this.children.length;i<e;i+=1)if(this.children[i].id==t.id){this.children.splice(i,1);break}},delParent:function(){this.parent.delChild(this)},setBox:function(t){t.offset&&(this.box.x=t.offset.x||0,this.box.y=t.offset.y||0),t.size&&(this.box.w=t.size.w||0,this.box.h=t.size.h||0)},isArrIntersect:function(t){var e,i=0;for(e=t.length;i<e;i+=1)if(t[i].id!==this.id&&this.isIntersect(t[i]))return t[i];return!1},isArrInside:function(t){var e,i=0;for(e=t.length;i<e;i+=1)if(this.isDynamicInside(t[i].getDynamicBox()))return t[i];return!1},getNearest:function(t){var e=0,i=!1,n,o=0;for(n=t.length;o<n;o+=1)if(this.id!==t[o].id){i===!1&&(i=this.getDistanceC(t[o].getPositionC()),e=o);var c=this.getDistanceC(t[o].getPositionC());c<i&&(i=c,e=o)}return t[e]},setFlip:function(t,e){E(t)&&this.flip.x!==t&&(this.flip.x=t),E(e)&&this.flip.y!==e&&(this.flip.y=e)},setUserData:function(t){for(var e in t)E(this[e])||(this[e]=t[e])},setShadow:function(t){this.shadowColor=t.shadowColor||!1,this.shadowBlur=E(t.shadowBlur)?t.shadowBlur:3,this.shadowX=t.shadowX||0,this.shadowY=t.shadowY||0},getDynamicBox:function(){var t=this.getPosition(1);return this.angle===0?[r(this.x+this.box.x,this.y+this.box.y),r(this.x+this.box.x+this.w+this.box.w,this.y+this.box.y),r(this.x+this.box.x+this.w+this.box.w,this.y+this.box.y+this.h+this.box.h),r(this.x+this.box.x,this.y+this.box.y+this.h+this.box.h)]:[B(r(this.x+this.box.x,this.y+this.box.y),t,this.getAngle()),B(r(this.x+this.box.x+this.w+this.box.w,this.y+this.box.y),t,this.getAngle()),B(r(this.x+this.box.x+this.w+this.box.w,this.y+this.box.y+this.h+this.box.h),t,this.getAngle()),B(r(this.x+this.box.x,this.y+this.box.y+this.h+this.box.h),t,this.getAngle())]},isDynamicIntersect:function(t){if(3>t.length)return!1;var e=this.getDynamicBox(),i;for(i=e.length-1;0<=i;i--)if(Pt(e[i],t))return!0;for(i=e.length-1;0<=i;i--)if(Pt(t[i],e))return!0;return!1},isIntersect:function(t){return t.visible?this.angle||t.angle?this.isDynamicIntersect(t.getDynamicBox()):this.isStaticIntersect(t.getStaticBox()):!1},isDynamicInside:function(t){if(3>t.length)return!1;var e=this.getDynamicBox(),i,n=0,o=0;for(i=e.length;o<i;o+=1)Pt(e[o],t)&&(n+=1);return n===e.length},drawDynamicBox:function(t,e,i,n,o){V(this,1),u.shadowColor="transparent",ot(r(this.x+this.box.x+(t||0),this.y+this.box.y+(e||0)),M(this.w+this.box.w+(2*i||0),this.h+this.box.h+(2*n||0)),!1,o||"red",2),Si(r(this.x+this.w/2+this.center.x,this.y+this.h/2+this.center.y),10,o||"red"),q()},drawStaticBox:function(t,e,i,n,o){u.shadowColor="transparent",ot(r(this.x+this.box.x+(t||0),this.y+this.box.y+(e||0)),M(this.w+this.box.w+(2*i||0),this.h+this.box.h+(2*n||0)),!1,o||"yellow",2),Si(r(this.x+this.w/2+this.center.x,this.y+this.h/2+this.center.y),10,o||"yellow")},drawStaticBoxA:function(t,e,i,n,o){u.shadowColor="transparent",ot(r(this.x+this.box.x+(t||0),this.y+this.box.y+1+(e||0)),M(this.w+this.box.w-1+(i||0),this.h+this.box.h-2+(n||0)),!1,o||"orange",2)},drawStaticBoxD:function(t,e,i,n,o){u.shadowColor="transparent",ot(r(this.x+this.box.x+1+(t||0),this.y+this.box.y+1+(e||0)),M(this.w+this.box.w-1+(i||0),this.h+this.box.h-2+(n||0)),!1,o||"red",2)},drawStaticBoxW:function(t,e,i,n,o){u.shadowColor="transparent",ot(r(this.x+this.box.x+1+(t||0),this.y+this.box.y+(e||0)),M(this.w+this.box.w-2+(i||0),this.h+this.box.h-1+(n||0)),!1,o||"blue",2)},drawStaticBoxS:function(t,e,i,n,o){u.shadowColor="transparent",ot(r(this.x+this.box.x+1+(t||0),this.y+this.box.y+1+(e||0)),M(this.w+this.box.w-2+(i||0),this.h+this.box.h-1+(n||0)),!1,o||"#329F93",2)},isStaticIntersect:function(t){return this.y+this.box.y+this.h+this.box.h>=t.y&&this.x+this.box.x+this.w+this.box.w>=t.x&&this.x+this.box.x<t.x+t.w&&this.y+this.box.y<t.y+t.h},getStaticBoxPosition:function(){return{x:this.x+this.box.x,y:this.y+this.box.y,w:this.x+this.box.x+this.w+this.box.w,h:this.y+this.box.y+this.h+this.box.h}},getStaticBox:function(t,e,i,n){return{x:this.x+this.box.x+(t||0),y:this.y+this.box.y+(e||0),w:this.w+this.box.w+(2*i||0),h:this.h+this.box.h+(2*n||0)}},getStaticBoxA:function(t,e,i,n){return{x:this.x+this.box.x+(t||0),y:this.y+this.box.y+1+(e||0),w:this.w+this.box.w-1+(i||0),h:this.h+this.box.h-2+(n||0)}},getStaticBoxD:function(t,e,i,n){return{x:this.x+this.box.x+1+(t||0),y:this.y+this.box.y+1+(e||0),w:this.w+this.box.w-1+(i||0),h:this.h+this.box.h-2+(n||0)}},getStaticBoxW:function(t,e,i,n){return{x:this.x+this.box.x+1+(t||0),y:this.y+this.box.y+(e||0),w:this.w+this.box.w-2+(i||0),h:this.h+this.box.h-1+(n||0)}},getStaticBoxS:function(t,e,i,n){return{x:this.x+this.box.x+1+(t||0),y:this.y+this.box.y+1+(e||0),w:this.w+this.box.w-1+(i||0),h:this.h+this.box.h-2+(n||0)}},setAlpha:function(t){this.alpha!==t&&(this.alpha=0<=t?1>=t?t:1:0)},transparent:function(t){this.setAlpha(this.alpha+t)},getAlpha:function(){return this.alpha},rotate:function(t){this.setAngle(Math.atan2(t.y-this.getPosition(1).y,t.x-this.getPosition(1).x)*(180/Math.PI))},setCenter:function(t){this.center=r(t.x,t.y)},nullCenter:function(t){t||(t=r(0,0)),this.center=r(-this.w/2+t.x,-this.h/2+t.y)},getCenter:function(){return r(this.center.x,this.center.y)},getBox:function(){return this.box},move:function(t){this.x+=t.x,this.y+=t.y},circling:function(t,e,i){E(this.circlingAnglePointJS)||(this.circlingAnglePointJS=0),this.x=t.x+e*Math.cos(O(this.circlingAnglePointJS)),this.y=t.y+e*Math.sin(O(this.circlingAnglePointJS)),this.circlingAnglePointJS=360<this.circlingAnglePointJS?0:this.circlingAnglePointJS+i},circlingC:function(t,e,i){E(this.circlingAnglePointJS)||(this.circlingAnglePointJS=0),this.setPositionC(r(t.x+e*Math.cos(O(this.circlingAnglePointJS)),t.y+e*Math.sin(O(this.circlingAnglePointJS)))),this.circlingAnglePointJS=360<this.circlingAnglePointJS?0:this.circlingAnglePointJS+i},motion:function(t,e,i){E(this.motionPercentPointJS)||(this.motionPercentPointJS=0),this.x=t.x+e.w*Math.cos(O(this.motionPercentPointJS)),this.y=t.y+e.h*Math.sin(O(this.motionPercentPointJS)),this.motionPercentPointJS=360<this.motionPercentPointJS?0:this.motionPercentPointJS+i},motionC:function(t,e,i){E(this.motionPercentPointJS)||(this.motionPercentPointJS=0),this.setPositionC(r(t.x+e.w*Math.cos(O(this.motionPercentPointJS)),t.y+e.h*Math.sin(O(this.motionPercentPointJS)))),this.motionPercentPointJS=360<this.motionPercentPointJS?0:this.motionPercentPointJS+i},scale:function(t){this.w*=t,this.h*=t},scaleC:function(t){var e=this.w,i=this.h;this.scale(t),this.move(r(-((this.w-e)/2),-((this.h-i)/2)))},getPosition:function(t){return t===1?r(this.x+(this.w/2+this.center.x),this.y+(this.h/2+this.center.y)):t===2?(t=r(this.x+this.w/2,this.y+this.h/2),this.angle&&(t=B(t,this.getPosition(1),this.angle)),r(t.x,t.y)):r(this.x,this.y)},getPositionC:function(){return r(this.x+(this.w/2+this.center.x),this.y+(this.h/2+this.center.y))},getPositionS:function(){return r(this.x+h.x,this.y+h.x)},getPositionCS:function(){return r(this.x+(this.w/2+this.center.x)+h.x,this.y+(this.h/2+this.center.y)+h.y)},setPosition:function(t){t.x!==!1&&(this.x=t.x),t.y!==!1&&(this.y=t.y)},setPositionS:function(t){t.x!==!1&&(this.x=t.x+h.x),t.y!==!1&&(this.y=t.y+h.y)},setPositionC:function(t){t.x!==!1&&(this.x=-(this.w/2+this.center.x)+t.x),t.y!==!1&&(this.y=-(this.h/2+this.center.y)+t.y)},setPositionCS:function(t){t.x!==!1&&(this.x=-(this.w/2+this.center.x)+t.x+h.x),t.y!==!1&&(this.y=-(this.h/2+this.center.y)+t.y+h.y)},getSize:function(){return M(this.w,this.h)},setSize:function(t){this.w=t.w,this.h=t.h},setSizeC:function(t){var e=this.w,i=this.h;this.w=t.w,this.h=t.h,this.move(r(-((this.w-e)/2),-((this.h-i)/2)))},turn:function(t){this.angle+=t},rotateForAngle:function(t,e){0>this.angle&&(this.angle+=360),0>t&&(t+=360);var i=this.angle-t;180<i?i-=360:-180>i&&(i+=360),i>=-e-.5&&i<=e+.5?this.angle=t:i>e+.5?this.angle-=e:i<-e-.5&&(this.angle+=e)},rotateForPoint:function(t,e){var i=Rt(this.getPositionC(),t);this.rotateForAngle(i,e)},rotateForObject:function(t,e){var i=Rt(this.getPositionC(),t.getPositionC());this.rotateForAngle(i,e)},moveTo:function(t,e){var i=O(Rt(this.getPosition(),t));this.x+=e*Math.cos(i),this.y+=e*Math.sin(i)},moveToC:function(t,e,i){t=O(Rt(this.getPositionC(),t)),this.x+=e*Math.cos(t),this.y+=i*Math.sin(t)},moveAngle:function(t,e){e=O(E(e)?e:this.angle),this.x+=t*Math.cos(e),this.y+=t*Math.sin(e)},moveTime:function(t,e){e=e||1;var i=this.getPosition();this.move(r((t.x-i.x)/e,(t.y-i.y)/e))},moveTimeC:function(t,e){e=e||1;var i=this.getPosition(1);this.move(r((t.x-i.x)/e,(t.y-i.y)/e))},getAngle:function(){return this.angle},setAngle:function(t){this.angle!==t&&(this.angle=t%360)},getDistance:function(t){return Math.sqrt(Math.pow(t.x-this.getPosition(2).x,2)+Math.pow(t.y-this.getPosition(2).y,2))},getDistanceC:function(t){return Math.sqrt(Math.pow(t.x-this.getPosition(1).x,2)+Math.pow(t.y-this.getPosition(1).y,2))},setVisible:function(t){this.visible=t===!0},isVisible:function(){return this.visible},isInCamera:function(){return this.angle?this.isInCameraDynamic():this.isInCameraStatic()},isInCameraStatic:function(){return!(this.x+this.w<h.x||this.x>h.x+y||this.y+this.h<h.y||this.y>h.y+a)},isInCameraDynamic:function(){var t=this.getDynamicBox(),e=[r(h.x,h.y),r(h.x+y,h.y),r(h.x+y,h.y+a),r(h.x,h.y+a)],i,n=0,o=0;for(i=t.length;o<i;o+=1)Pt(t[o],e)&&(n+=1);return 0<n},draw:function(){}},this.game.newBaseObject=function(t){return new b(t)};var ve=function(t){b.call(this,t),this.type="TriangleObject"};ut(b,ve),ve.prototype.getDynamicBox=function(){var t=this.getPositionC();return this.angle===0?[r(this.x+this.w/2,this.y),r(this.x+this.w,this.y+this.h),r(this.x,this.y+this.h)]:[B(r(this.x+this.w/2,this.y),t,this.getAngle()),B(r(this.x+this.w,this.y+this.h),t,this.getAngle()),B(r(this.x,this.y+this.h),t,this.getAngle())]},ve.prototype.draw=function(){if(this.predraw(),this.visible&&this.alpha){var t=!1;(this.angle||this.alpha!==1||this.shadowColor)&&(V(this),t=!0),Vt(this.x,this.y,[r(this.w/2,0),r(this.w,this.h),r(0,this.h)],this.fillColor,this.strokeWidth?this.strokeColor:!1,this.strokeWidth),this.ondraw&&this.ondraw(),t&&q()}},this.game.newTriangleObject=function(t){return new ve(t)};var Je=function(t){b.call(this,t),this.type="RectObject"};ut(b,Je),Je.prototype.draw=function(){if(this.predraw(),this.visible&&this.alpha){var t=!1;(this.angle||this.alpha!==1||this.shadowColor)&&(V(this),t=!0),ot(r(this.x,this.y),M(this.w,this.h),this.fillColor,this.strokeColor,this.strokeWidth),this.ondraw&&this.ondraw(),t&&q()}},this.game.newRectObject=function(t){return new Je(t)};var Be=function(t){b.call(this,t),this.type="RoundRectObject",this.radius=t.radius||1};ut(b,Be),Be.prototype.draw=function(){if(this.predraw(),this.visible&&this.alpha){var t=!1;(this.angle||this.alpha!==1||this.shadowColor)&&(V(this),t=!0),Se(r(this.x,this.y),M(this.w,this.h),this.radius,this.fillColor,this.strokeColor,this.strokeWidth),this.ondraw&&this.ondraw(),t&&q()}},this.game.newRoundRectObject=function(t){return new Be(t)};var dt=function(t){b.call(this,t),this.radius=t.radius||5,t.scale&&(this.radius*=t.scale),this.w=2*this.radius,this.h=2*this.radius,this.type="CircleObject",t.positionC&&this.setPositionC(t.positionC)};ut(b,dt),dt.prototype.draw=function(){if(this.predraw(),this.visible){if(!this.alpha)return this.ondraw?this.ondraw():null;var t=!1;(this.angle||this.alpha!==1||this.shadowColor)&&(V(this),t=!0),Lt(r(this.x,this.y),this.radius,this.fillColor,this.strokeColor,this.strokeWidth),this.ondraw&&this.ondraw(),t&&q()}},dt.prototype.scale=function(t){this.w*=t||0,this.h*=t||0,this.radius*=t},dt.prototype.scaleC=function(t){var e=this.w,i=this.h;this.w*=t||0,this.h*=t||0,this.radius*=t,this.move(r(-((this.w-e)/2),-((this.h-i)/2)))},dt.prototype.getRadius=function(){return this.radius},dt.prototype.setRadius=function(t){t&&this.radius!==t&&(1>t&&(t=1,console.log("Внимание! Радиус окружности не может равняться нулю или быть отрицательным")),this.radius=t,this.w=2*t,this.h=2*t)},dt.prototype.setRadiusC=function(t,e,i){if(t&&this.radius!==t){1>t&&(t=1,console.log("Внимание! Радиус окружности не может равняться нулю или быть отрицательным"));var n=this.w,o=this.h;this.radius=t,this.w=2*t,this.h=2*t,this.move(r(-((this.w-n+(e||0))/2),-((this.h-o+(i||0))/2)))}},this.game.newCircleObject=function(t){return new dt(t)};var je=function(t){this.file=t.file,this.w=t.w,this.h=t.h,this.read={x:0,y:0,w:0,h:0},t.read&&(this.read.w=t.read.w||0,this.read.h=t.read.h||0,this.read.x=t.read.x||0,this.read.y=t.read.y||0),this.countX=t.countX,this.countY=t.countY,this.fullW=this.countX*this.w,this.fullH=this.countY*this.h,this.cnv=l.document.createElement("canvas"),this.cnv.width=this.w,this.cnv.height=this.h,this.ctx=this.cnv.getContext("2d"),this.loaded=!1,this.x=t.x||0,this.y=t.y||0,t=l.document.createElement("img");var e=this;t.onload=function(){e.ctx.drawImage(this,e.read.x?e.read.x:0,e.read.y?e.read.y:0,e.read.w?e.read.w:this.width,e.read.h?e.read.h:this.height,0,0,e.w,e.h),e.loaded=!0,T.load()},t.src=this.file,T.add()};je.prototype.draw=function(){if(this.loaded){var t=-h.x+this.x,e=-h.y+this.y,i,n;for(n=0;n<this.countY;n+=1)if(!(this.y+n*this.h+this.h<h.y||this.y+n*this.h>h.y+a))for(i=0;i<this.countX;i+=1)this.x+i*this.w+this.w<h.x||this.x+i*this.w>h.x+y||u.drawImage(this.cnv,t+i*this.w,e+n*this.h,this.w,this.h)}},je.prototype.getSize=function(){return this.loaded?M(this.fullW,this.fullH):M()},this.game.newBackgroundObject=function(t){return new je(t)};var Ye=function(t){b.call(this,t),this.type="EllipsObject"};ut(b,Ye),Ye.prototype.draw=function(){this.predraw(),this.visible&&this.alpha&&(V(this),Lt(r(this.x,this.y),this.h/2,this.fillColor,this.strokeColor,this.strokeWidth),this.ondraw&&this.ondraw(),q())},this.game.newEllipsObject=function(t){return new Ye(t)};var st=function(t){b.call(this,t),this.type="TextObject",this.text=t.text||"TextObject",this.color=t.color||"",this.size=0<t.size?t.size:10,t.scale&&(this.size*=t.scale),this.font=t.font||"serif",this.style=t.style||"",this.align="left",this.valign="top",this.radius=t.radius||0,this.padding=t.padding||0,this.w=St(this.text,this.style,this.size,this.font)+2*this.padding,this.h=this.size+2*this.padding,this.strokeColorText=t.strokeColorText||!1,this.strokeWidthText=t.strokeWidthText||!1,this.textDY=-this.size/11,t.positionC&&this.setPositionC(t.positionC)};ut(b,st),st.prototype.reStyle=function(t){this.text=t.text||this.text,this.color=t.color||this.color,this.size=t.size||this.size,this.font=t.font||this.font,this.style=t.style||this.style,this.padding=t.padding||this.padding,this.w=St(this.text,this.style,this.size,this.font)+2*this.padding,this.h=this.size+2*this.padding,this.strokeColorText=t.strokeColorText||this.strokeColorText,this.strokeWidthText=t.strokeWidthText||this.strokeWidthText,this.strokeColor=t.strokeColor||this.strokeColor,this.strokeWidth=t.strokeWidth||this.strokeWidth,this.fillColor=t.fillColor||this.fillColor,this.textDY=-this.size/11},st.prototype.setText=function(t){this.text!==t&&this.reStyle({text:t})},st.prototype.getText=function(){return this.text},st.prototype.draw=function(){if(this.predraw(),this.visible&&this.alpha){var t=!1;(this.angle||this.alpha!==1||this.shadowColor)&&(V(this),t=!0),(this.fillColor||this.strokeColor)&&(this.radius?Se(r(this.x,this.y),M(this.w,this.h),this.radius,this.fillColor,this.strokeColor,this.strokeWidth):ot(r(this.x,this.y),M(this.w,this.h),this.fillColor,this.strokeColor,this.strokeWidth)),Ot(r(this.x+this.padding,this.textDY+this.y+this.padding),this.text,this.color,this.size,this.font,this.style,this.align,this.strokeColorText,this.strokeWidthText),this.ondraw&&this.ondraw(),t&&q()}},st.prototype.scale=function(t){this.reStyle({size:this.size*t})},st.prototype.scaleC=function(t){var e=this.w,i=this.h;this.reStyle({size:this.size*t}),this.move(r(-((this.w-e)/2),-((this.h-i)/2)))},st.prototype.setSize=function(t){this.size!==t&&this.reStyle({size:t})},st.prototype.setSizeC=function(t){this.size!==t&&(this.reStyle({size:t}),this.move(r(-t/2,-t/2)))},St=function(t,e,i,n){var o=l.document.createElement("canvas").getContext("2d");return o.font=(e?e+" ":"")+i+"px "+n,o.measureText(t).width},this.OOP.getTextWidth=function(t){return St(t.text,t.style||"",t.size||10,t.font||"serif")},this.game.newTextObject=function(t){return new st(t)};var Z=function(t){b.call(this,t),this.type="PolygonObject",this.points=[],this.pointColor=t.pointColor||!1,this.w=this.h=0;var e=this;typeof t.points<"u"&&C(t.points,function(i){e.addPoint(i)})};ut(b,Z),Z.prototype.addPoint=function(t){this.points.push(t),t.x>this.w&&(this.w=t.x),t.x>this.h&&(this.h=t.x)},Z.prototype.delPoint=function(t){this.points.splice(t,1)},Z.prototype.clearPoints=function(){this.points.length=0},Z.prototype.getPoints=function(){return this.points},Z.prototype.getCount=function(){return this.points.length},Z.prototype.getPoint=function(t){return this.points[t]},Z.prototype.isIntersect=function(t){return t.visible?this.isDynamicIntersect(t.getDynamicBox()):!1},Z.prototype.drawDynamicBox=function(t){Vt(this.x,this.y,this.points,!1,"yellow",1,"red")},Z.prototype.getDynamicBox=function(){for(var t=[],e=this.points.length-1;0<=e;e--)t.push(B(this.points[e],r(this.w/2+this.center.x,this.h/2+this.center.y),this.angle).plus(r(this.x,this.y)));return t},Z.prototype.draw=function(){if(this.predraw(),this.visible&&this.alpha){var t=!1;(this.angle||this.alpha!==1||this.shadowColor)&&(V(this),t=!0),Vt(this.x,this.y,this.points,this.fillColor,this.strokeColor,this.strokeWidth,this.pointColor),this.ondraw&&this.ondraw(),t&&q()}},this.game.newPolygonObject=function(t){return new Z(t)};var At=function(t){b.call(this,t),this.type="ImageObject",this.loaded=!1,this.file="",this.forOnLoad=t.onload||!1,wi(t.file,this,t.scale||1)};ut(b,At),At.prototype.draw=function(){if(this.predraw(),this.visible&&this.alpha&&this.loaded){var t=!1;(this.angle||this.alpha!==1||this.shadowColor||this.flip.x||this.flip.y)&&(V(this),t=!0),vi(r(this.x,this.y),M(this.w,this.h),this.file),this.ondraw&&this.ondraw(),t&&q()}},At.prototype.simpleDraw=function(t){if(this.predraw(),this.loaded){var e=!1;(this.angle||this.alpha!==1||this.shadowColor)&&(V(this),e=!0),vi(r(t.x,t.y),M(this.w,this.h),this.file),e&&q()}},At.prototype.setImage=function(t,e){this.file!==t&&(E(x[t])?(this.file=t,e&&e()):(this.loaded=!1,this.origHeight=this.origWidth=0,this.forOnLoad=e||!1,wi(t,this)))},At.prototype.getImage=function(){return this.file},At.prototype.resize=function(t){if(t.w!==!1&&t.h===!1){var e=t.w/this.w;this.w=t.w,this.h*=e}else t.h!==!1&&t.w===!1?(e=t.h/this.h,this.h=t.h,this.w*=e):t.w!==!1&&t.h!==!1&&(this.w=t.w,this.h=t.h)},this.game.newImageObject=function(t){return new At(t)};var U=function(t){b.call(this,t),this.type="AnimationObject",this.frame=0,this.anim=t.animation,this.step=t.delay||10,this.toFrameStep=this.difStep=0,t.scale&&(this.w*=t.scale,this.h*=t.scale)};ut(b,U),U.prototype.draw=function(){if(this.visible&&this.alpha){var t=!1;(this.angle||this.alpha!==1||this.flip.x||this.flip.y||this.shadowColor)&&(V(this),t=!0),_e(this.anim,r(this.x,this.y),M(this.w,this.h),this.frame),this.ondraw&&this.ondraw(),this.difStep>this.step?(this.frame=this.frame<this.anim.r?this.frame+1:0,this.difStep=0):this.difStep+=1,t&&q()}},U.prototype.drawFrames=function(t,e,i){this.visible&&this.alpha&&((this.frame<t||this.frame>e)&&(this.frame=t),i=!1,(this.angle||this.alpha!==1||this.flip.x||this.flip.y||this.shadowColor)&&(V(this),i=!0),_e(this.anim,r(this.x,this.y),M(this.w,this.h),this.frame),this.ondraw&&this.ondraw(),this.difStep>this.step?(this.frame=this.frame<e?this.frame+1:t,this.difStep=0):this.difStep+=1,i&&q())},U.prototype.drawFrame=function(t){if(this.visible&&this.alpha){var e=!1;(this.angle||this.alpha!==1||this.flip.x||this.flip.y||this.shadowColor)&&(V(this),e=!0),_e(this.anim,r(this.x,this.y),M(this.w,this.h),t),this.ondraw&&this.ondraw(),e&&q()}},U.prototype.drawToFrame=function(t){if(this.visible&&this.alpha){if(this.frame<t)this.toFrameStep=1;else if(this.frame>t)this.toFrameStep=-1;else{this.drawFrame(t);return}this.drawFrame(this.frame),this.ondraw&&this.ondraw(),this.difStep>this.step?(this.frame=this.frame<this.anim.r?this.frame+this.toFrameStep:0,this.difStep=0):this.difStep+=1}},U.prototype.drawReverFrames=function(t,e){this.visible&&this.alpha&&(this.drawFrame(this.frame),this.ondraw&&this.ondraw(),this.difStep>this.step?(this.frame<=t?this.toFrameStep=1:this.frame>=e&&(this.toFrameStep=-1),this.frame+=this.toFrameStep,this.difStep=0):this.difStep+=1)},U.prototype.setAnimation=function(t){t!==this.anim&&(this.frame=0,this.anim=t)},U.prototype.getAnimation=function(){return this.anim},U.prototype.setDelay=function(t){this.step=0<t?t:this.step},U.prototype.getDelay=function(){return this.step},U.prototype.getFrame=function(){return this.frame},U.prototype.setFrame=function(t){this.frame=t},U.prototype.getLastFrame=function(){return this.anim.endFrame},this.game.newAnimationObject=function(t){return new U(t)};var gi=function(t){var e=!1;return t.type==="RectObject"?e=v.game.newRectObject({}):t.type==="CircleObject"?e=v.game.newCircleObject({}):t.type==="RoundRectObject"?e=v.game.newRoundRectObject({}):t.type==="TextObject"?e=v.game.newTextObject({}):t.type==="EllipsObject"?e=v.game.newEllipsObject({}):t.type==="ImageObject"?e=v.game.newImageObject({file:t.file}):t.type==="TriangleObject"?e=v.game.newTriangleObject({}):t.type==="PolygonObject"?e=v.game.newTriangleObject({points:t.points}):t.type==="AnimationObject"&&(e=v.game.newAnimationObject({animation:t.anim})),e},We={},ji=0,Mt=function(t,e){this.file=t,this.loaded=!1,this.h=this.w=0,this.id=ji++,this.toLoad=[];var i=l.document.createElement("img"),n=this;We[t]=n,i.onload=function(){n.loaded=!0,n.w=this.width,n.h=this.height,n.img=l.document.createElement("canvas"),n.img.width=this.width,n.img.height=this.height,n.context=n.img.getContext("2d"),n.context.drawImage(this,0,0),n.toLoad.length&&C(n.toLoad,function(o){o.func(n.context,o.w,o.h,o.r)}),e&&(n.onLoad=e,n.onLoad()),T.load()},i.src=t,T.add()};Mt.prototype.onContext=function(t){this.loaded?t(this.context,this.w,this.h,1):this.toLoad.push({w:this.w,h:this.h,r:1,func:t})},Mt.prototype.getCanvas=function(){return this.img};var Yi=0;Mt.prototype.getAnimation=function(t,e,i,n,o){var c=function(f,d,p,S,k,I){this.id=Yi++,this.image=f,this.x=d,this.y=p,this.w=S,this.h=k,this.endFrame=this.r=I?I-1:0,this.frameCount=this.r+1};return c.prototype={onContext:function(f){this.image.loaded?f(this.image.context,this.w,this.h,this.r):this.image.toLoad.push({w:this.w,h:this.h,r:this.r,func:f})},getImage:function(){return this.image},getCount:function(){return this.r}},new c(this,t,e,i,n,o)};var Ge=function(t,e){this.loaded=!0,this.w=t,this.h=e,this.img=l.document.createElement("canvas"),this.img.width=t,this.img.height=e,this.context=this.img.getContext("2d")};Ge.prototype.onContext=Mt.prototype.onContext,Ge.prototype.getAnimation=Mt.prototype.getAnimation,this.tiles.newDrawImage=function(t,e){return new Ge(t,e)},this.tiles.newImage=function(t,e){return We[t]?We[t]:new Mt(t,e)},this.tiles.newAnimation=function(t,e,i,n){return new Mt(t).getAnimation(0,0,e,i,n)};var _e=function(t,e,i,n){if(t&&t.image.loaded){var o=-h.x,c=-h.y;t.image.img&&u.drawImage(t.image.img,t.x+t.w*n,t.y,t.w,t.h,e.x+o,e.y+c,i.w,i.h)}},x={},wi=function(t,e,i){if(E(x[t])){if(e.loaded=!0,e.file=t,e.w&&!e.h)var n=e.w/x[t].w,o=e.w,c=x[t].h*n;else!e.w&&e.h?(n=e.h/x[t].h,c=e.h,o=x[t].w*n):e.w&&e.h?(o=e.w,c=e.h):(o=x[t].w,c=x[t].h);i&&(o*=i,c*=i),e.w=o,e.h=c,e.forOnLoad&&e.forOnLoad()}else o=l.document.createElement("img"),o.onload=function(){if(x[t]={},x[t].loaded=!0,x[t].img=this,x[t].w=this.width,x[t].h=this.height,E(e)){if(e.loaded=!0,e.w&&!e.h)var f=e.w/x[t].w,d=e.w,p=x[t].h*f;else!e.w&&e.h?(f=e.h/x[t].h,p=e.h,d=x[t].w*f):e.w&&e.h?(d=e.w,p=e.h):(d=x[t].w,p=x[t].h);i&&(d*=i,p*=i),e.w=d,e.h=p,e.file=t,e.forOnLoad&&e.forOnLoad()}T.load()},o.src=t,T.add()},vi=function(t,e,i){if(i){var n=-h.x,o=-h.y;x[i]&&u.drawImage(x[i].img,0,0,x[i].w,x[i].h,t.x+n,t.y+o,e.w,e.h)}},Pi=function(t){this.type="Mesh",this.objs=[],this.x=t.x||0,this.y=t.y||0,this.angle=t.angle||0,this.count=0;var e=this;t.add&&C(t.add,function(i){e.add(i)}),this.angle&&this.setAngle(this.angle)};Pi.prototype={getCount:function(){return this.count},getObjects:function(){return this.objs},add:function(t){this.count+=1,this.objs.push(t),t.offsetMesh=t.getPosition(1),t.turn(this.angle),t.setPositionC(r(this.x+t.offsetMesh.x,this.y+t.offsetMesh.y))},del:function(t){var e=this;C(this.objs,function(i){i.id==t.id&&(e.objs.splice(void 0,1),e.count--)})},draw:function(t){C(this.objs,function(e){e.draw()})},move:function(t){this.x+=t.x||0,this.y+=t.y||0;var e=this;C(this.objs,function(i){i.setPositionC(r(e.x+i.offsetMesh.x,e.y+i.offsetMesh.y))})},turn:function(t){if(t!=0){this.angle%=360,this.angle+=t;var e=r(this.x,this.y),i=this;C(this.objs,function(n){n.turn(t),n.setPositionC(B(r(i.x+n.offsetMesh.x,i.y+n.offsetMesh.y),e,i.angle))})}},setAngle:function(t){if(t!=this.angle){this.angle=t%=360;var e=r(this.x,this.y),i=this;C(this.objs,function(n){n.setAngle(t),n.setPositionC(B(r(i.x+n.offsetMesh.x,i.y+n.offsetMesh.y),e,i.angle))})}},setPosition:function(t){if(this.x!=t.x||this.y!=t.y){this.x=t.x||this.x,this.y=t.y||this.y;var e=this;C(this.objs,function(i){e.angle?i.setPositionC(B(r(e.x+i.offsetMesh.x,e.y+i.offsetMesh.y),r(e.x,e.y),e.angle)):i.setPositionC(r(e.x+i.offsetMesh.x,e.y+i.offsetMesh.y))})}},isDynamicIntersect:function(t){if(3>t.length)return!1;var e=!1;return C(this.objs,function(i){if(i.isDynamicIntersect(t))return e=i}),e},isStaticIntersect:function(t){var e=!1;return C(this.objs,function(i){if(i.isStaticIntersect(t))return e=i}),e},isIntersect:function(t){var e=!1;return C(this.objs,function(i){if(i.isIntersect(t))return e=i}),e}},this.game.newMesh=function(t){return new Pi(t)},this.camera.shake=function(t,e){h.x=t.x+K(-1,1,!0)*e.w,h.y=t.y+K(-1,1,!0)*e.h},this.camera.shakeC=function(t,e){h.x=-R+t.x+K(-1,1,!0)*e.w,h.y=-J+t.y+K(-1,1,!0)*e.h},this.camera.scale=function(t){wt*=t.x,vt*=t.y,y/=t.x,a/=t.y,R=y/2,J=a/2,u.scale(t.x,t.y),u.save(),_t&&(z.x/=t.x,z.y/=t.y)},this.camera.scaleC=function(t){var e=y,i=a;wt*=t.x,vt*=t.y,y/=t.x,a/=t.y,R=y/2,J=a/2,u.scale(t.x,t.y),u.save(),h.x+=(e-y)/2,h.y+=(i-a)/2,_t&&(z.x/=t.x,z.y/=t.y)},this.camera.circling=function(t,e,i){E(this.circlingAnglePointJS)||(this.circlingAnglePointJS=i),h.x=t.x+e*Math.cos(O(this.circlingAnglePointJS)),h.y=t.y+e*Math.sin(O(this.circlingAnglePointJS)),this.circlingAnglePointJS=360<=this.circlingAnglePointJS?i:this.circlingAnglePointJS+i},this.camera.circlingC=function(t,e,i){E(this.circlingAnglePointJS)||(this.circlingAnglePointJS=i),h.x=-R+t.x+e*Math.cos(O(this.circlingAnglePointJS)),h.y=-J+t.y+e*Math.sin(O(this.circlingAnglePointJS)),this.circlingAnglePointJS=360<=this.circlingAnglePointJS?i:this.circlingAnglePointJS+i},this.camera.motion=function(t,e,i){E(this.motionPercentPointJS)||(this.motionPercentPointJS=e),h.x=t.x+e.w*Math.cos(O(this.motionPercentPointJS)),h.y=t.y+e.h*Math.sin(O(this.motionPercentPointJS)),this.motionPercentPointJS=360<=this.motionPercentPointJS?e:this.motionPercentPointJS+i},this.camera.motionC=function(t,e,i){E(this.motionPercentPointJS)||(this.motionPercentPointJS=e),this.setPositionC(r(t.x+e.w*Math.cos(O(this.motionPercentPointJS)),t.y+e.h*Math.sin(O(this.motionPercentPointJS)))),this.motionPercentPointJS=360<=this.motionPercentPointJS?e:this.motionPercentPointJS+i},this.camera.follow=function(t,e){this.moveTimeC(t.getPositionC(),e||10)},this.camera.move=function(t){h.x+=t.x||0,h.y+=t.y||0},this.camera.moveTime=function(t,e){e=e||1;var i=r(h.x,h.y);this.move(r(wt*(t.x-i.x)/e,vt*(t.y-i.y)/e))},this.camera.moveTimeC=function(t,e){e=e||1;var i=r(h.x+R,h.y+J);this.move(r(wt*(t.x-i.x)/e,vt*(t.y-i.y)/e))},this.camera.setPosition=function(t){Xe(r(t.x!==!1?t.x:h.x,t.y!==!1?t.y:h.y))},this.camera.setPositionC=function(t){Xe(r(t.x!==!1?t.x-R:h.x,t.y!==!1?t.y-J:h.y))},this.camera.getPosition=function(t){return t?r(h.x+R,h.y+J):r(h.x,h.y)},this.camera.getPositionC=function(){return r(h.x+R,h.y+J)},this.camera.getStaticBox=function(){return{x:h.x,y:h.y,w:y,h:a}},this.camera.getDynamicBox=function(){return[r(h.x,h.y),r(h.x+y,h.y),r(h.x+y,h.y+a),r(h.x,h.y+a)]};var Xe=function(t){h=r(t.x,t.y)},q=function(t){u.restore(),u.globalAlpha=P.globalAlpha,u.fillStyle="black",u.strokeStyle="black",u.msImageSmoothingEnabled=zt,u.imageSmoothingEnabled=zt},V=function(t,e){u.save();var i=t.getPositionC();if(t.angle&&(u.translate(-h.x+i.x,-h.y+i.y),u.rotate(O(t.angle)),u.translate(-i.x+h.x,-i.y+h.y)),t.alpha!==1&&(u.globalAlpha=t.alpha),(t.flip.x||t.flip.y)&&(u.translate(-h.x+i.x,-h.y+i.y),u.scale(t.flip.x?-1:1,t.flip.y?-1:1),u.translate(-i.x+h.x,-i.y+h.y)),t.shadowColor&&(u.shadowBlur=t.shadowBlur,u.shadowColor=t.shadowColor,u.shadowOffsetX=t.shadowX,u.shadowOffsetY=t.shadowY),t.type==="EllipsObject"&&!e){i=t.w/2;var n=t.h/2,o=r(-h.x+t.x,-h.y+t.y);u.translate(o.x,o.y),u.scale(i/n,1),u.translate(-o.x,-o.y)}};this.system.setContextSettings=function(t){u.save();for(var e in t)u[e]=t[e]},this.system.defaultSettings=function(){q()},this.game.clear=function(){u.clearRect(0,0,y,a)},this.game.fill=function(t){u.fillStyle=t,u.fillRect(0,0,y,a)};var Vt=function(t,e,i,n,o,c,f){if(!(3>i.length)){if(n&&!(3>i.length)){u.fillStyle=n,n=-h.x+t;var d=-h.y+e,p;for(u.beginPath(),u.moveTo(n+i[0].x,d+i[0].y),p=1;p<i.length;p+=1)u.lineTo(n+i[p].x,d+i[p].y);u.closePath(),u.fill()}for(n=0;n<i.length;n+=1)d=n+1<i.length?n+1:0,o&&rt(Qt(i[n],r(t,e)),Qt(i[d],r(t,e)),o,c),f&&Pe(Qt(i[n],r(t,e)),f)}},Q=function(t){t.x||(t.x=0),t.y||(t.y=0),t.w||(t.w=0),t.h||(t.h=0)};this.brush.drawPolygon=function(t){var e=t.points||[],i=t.fillColor||!1,n=t.strokeColor||!1,o=t.strokeWidth||1;if(t=t.pointColor||!1,!(3>e.length)){if(i&&!(3>e.length)){u.fillStyle=i,i=-h.x;var c=-h.y,f;for(u.beginPath(),u.moveTo(i+e[0].x,c+e[0].y),f=1;f<e.length;f+=1)u.lineTo(i+e[f].x,c+e[f].y);u.closePath(),u.fill()}for(i=0;i<e.length;i+=1)c=i+1<e.length?i+1:0,n&&rt(e[i],e[c],n,o),t&&Pe(e[i],t)}},this.brush.drawTriangle=function(t){if(Q(t),t.x+t.w<h.x||t.x>h.x+y||t.y+t.h<h.y||t.y>h.y+a)return!1;Vt(t.x,t.y,[r(t.w/2,0),r(t.w,t.h),r(0,t.h)],t.fillColor,t.strokeColor,t.strokeWidth)},this.brush.drawTriangleS=function(t){if(Q(t),0>t.x+t.w||t.x>y||0>t.y+t.h||t.y>a)return!1;Vt(h.x+t.x,h.y+t.y,[r(t.w/2,0),r(t.w,t.h),r(0,t.h)],t.fillColor,t.strokeColor,t.strokeWidth)};var Ot=function(t,e,i,n,o,c,f,d,p){u.textAlign=f,u.lineWidth=p,u.font=(c?c+" ":"")+n+"px "+o,n=-h.x,o=-h.y,i&&(u.fillStyle=i,u.fillText(e,n+t.x,o+t.y)),d&&(u.strokeStyle=d,u.strokeText(e,n+t.x,o+t.y))};this.brush.drawMultiText=function(t){var e,i=t.text.split(`
`);for(e=0;e<i.length;e+=1)Ot(r(t.x,t.y+t.size*e),i[e],t.color||P.fillStyle,t.size||10,t.font||P.font,t.style||!1,t.align||"left",t.strokeColor||!1,t.strokeWidth||2)},this.brush.drawMultiTextS=function(t){var e,i=t.text.split(`
`),n=t.size||10;for(e=0;e<i.length;e+=1)Ot(r(t.x+h.x,t.y+h.y+n*e),i[e],t.color||P.fillStyle,n||10,t.font||P.font,t.style||!1,t.align||"left",t.strokeColor||!1,t.strokeWidth||2)},this.brush.drawText=function(t){Ot(r(t.x||0,t.y||0),t.text,t.color||!1,t.size||10,t.font||P.font,t.style||!1,t.align||"left",t.strokeColor||!1,t.strokeWidth||2)},this.brush.drawTextS=function(t){Ot(r((t.x||0)+h.x,(t.y||0)+h.y),t.text,t.color||P.fillStyle,t.size||10,t.font||P.font,t.style||!1,t.align||"left",t.strokeColor||!1,t.strokeWidth||2)},this.brush.drawTextLines=function(t){if(t.lines){var e,i=t.size||10;for(e=0;e<t.lines.length;e+=1)Ot(r(t.x||0,(t.y||0)+i*e*t.lineHeight),t.lines[e],t.color||P.fillStyle,i,t.font||P.font,t.style||!1,t.align||"left",t.strokeColor||!1,t.strokeWidth||2)}},this.brush.drawTextLinesS=function(t){if(t.lines){var e,i=t.size||10;for(e=0;e<t.lines.length;e+=1)Ot(r((t.x||0)+h.x,(t.y||0)+h.y+i*e*t.lineHeight),t.lines[e],t.color||P.fillStyle,i,t.font||P.font,t.style||!1,t.align||"left",t.strokeColor||!1,t.strokeWidth||2)}};var Si=function(t,e,i){rt(r(t.x-e,t.y),r(t.x+e,t.y),i,2),rt(r(t.x,t.y-e),r(t.x,t.y+e),i,2)},ot=function(t,e,i,n,o){u.fillStyle=i,u.strokeStyle=n,n=-h.x;var c=-h.y;i&&u.fillRect(t.x+n,t.y+c,e.w,e.h),o&&(u.lineWidth=o,i=o/2,u.strokeRect(t.x+n+i,t.y+c+i,e.w-o,e.h-o))};this.brush.drawRect=function(t){if(Q(t),t.x+t.w<h.x||t.x>h.x+y||t.y+t.h<h.y||t.y>h.y+a)return!1;ot(r(t.x,t.y),M(t.w,t.h),t.fillColor||!1,t.strokeColor||P.strokeStyle,t.strokeWidth||!1)},this.brush.drawRectS=function(t){if(Q(t),0>t.x+t.w||t.x>y||0>t.y+t.h||t.y>a)return!1;ot(r(t.x+h.x,t.y+h.y),M(t.w,t.h),t.fillColor||!1,t.strokeColor||P.strokeStyle,t.strokeWidth||!1)};var Pe=function(t,e){(u.fillStyle=e)&&u.fillRect(-h.x+t.x-1,-h.y+t.y-1,2,2)};this.brush.drawPoint=function(t){if(Q(t),t.x<h.x||t.x>h.x+y||t.y<h.y||t.y>h.y+a)return!1;Pe(r(t.x,t.y),t.fillColor||!1)},this.brush.drawPointS=function(t){if(Q(t),0>t.x||t.x>y||0>t.y||t.y>a)return!1;Pe(r(t.x+h.x,t.y+h.y),t.fillColor||!1)};var Se=function(t,e,i,n,o,c){u.fillStyle=n,u.strokeStyle=o,u.lineWidth=c,o=-h.x+t.x+c/2,t=-h.y+t.y+c/2,e.w-=+c,e.h-=+c,u.beginPath(),u.moveTo(o+i,t),u.lineTo(o+e.w-i,t),u.quadraticCurveTo(o+e.w,t,o+e.w,t+i),u.lineTo(o+e.w,t+e.h-i),u.quadraticCurveTo(o+e.w,t+e.h,o+e.w-i,t+e.h),u.lineTo(o+i,t+e.h),u.quadraticCurveTo(o,t+e.h,o,t+e.h-i),u.lineTo(o,t+i),u.quadraticCurveTo(o,t,o+i,t),u.closePath(),n&&u.fill(),c&&u.stroke()};this.brush.drawRoundRect=function(t){if(Q(t),t.x+t.w<h.x||t.x>h.x+y||t.y+t.h<h.y||t.y>h.y+a)return!1;Se(r(t.x,t.y),M(t.w,t.h),t.radius||2,t.fillColor||!1,t.strokeColor||P.strokeStyle,t.strokeWidth||!1)},this.brush.drawRoundRectS=function(t){if(Q(t),0>t.x+t.w||t.x>y||0>t.y+t.h||t.y>a)return!1;Se(r(h.x+t.x,h.y+t.y),M(t.w,t.h),t.radius||2,t.fillColor||!1,t.strokeColor||P.strokeStyle,t.strokeWidth||!1)};var Lt=function(t,e,i,n,o){u.fillStyle=i,u.strokeStyle=n,u.lineWidth=o,n=-h.x+e+(o?o/2:0);var c=-h.y+e+(o?o/2:0);u.beginPath(),u.arc(t.x+n,t.y+c,e,0,2*Math.PI,!0),u.closePath(),i&&u.fill(),o&&u.stroke()};this.brush.drawCircle=function(t){Q(t);var e=2*t.radius;if(t.x+e<h.x||t.x>h.x+y||t.y+e<h.y||t.y>h.y+a)return!1;Lt(r(t.x,t.y),t.radius,t.fillColor||!1,t.strokeColor||P.strokeStyle,t.strokeWidth||!1)},this.brush.drawCircleS=function(t){Q(t);var e=2*t.radius;if(0>t.x+e||t.x>y||0>t.y+e||t.y>a)return!1;Lt(r(t.x+h.x,t.y+h.y),t.radius,t.fillColor||!1,t.strokeColor||P.strokeStyle,t.strokeWidth||!1)};var rt=function(t,e,i,n){u.strokeStyle=i,u.lineWidth=n,i=-h.x,n=-h.y,u.beginPath(),u.moveTo(i+t.x,n+t.y),u.lineTo(i+e.x,n+e.y),u.closePath(),u.stroke()};this.brush.drawLineAngle=function(t){var e=B(r(t.x+t.length,t.y),r(t.x,t.y),t.angle);rt(r(t.x,t.y),r(e.x,e.y),t.strokeColor||P.strokeStyle,t.strokeWidth||1)},this.brush.drawLineAngleS=function(t){var e=B(r(h.x+t.x+t.length,h.y+t.y),r(h.x+t.x,h.y+t.y),t.angle);rt(r(h.x+t.x,h.y+t.y),r(e.x,e.y),t.strokeColor||P.strokeStyle,t.strokeWidth||1)},this.brush.drawLine=function(t){rt(r(t.x1,t.y1),r(t.x1+t.x2,t.y1+t.y2),t.strokeColor||P.strokeStyle,t.strokeWidth||1)},this.brush.drawLineS=function(t){rt(r(h.x+t.x1,h.y+t.y1),r(h.x+t.x2,h.y+t.y2),t.strokeColor||P.strokeStyle,t.strokeWidth||1)},this.brush.drawLineA=function(t){rt(r(t.x1,t.y1),r(t.x2,t.y2),t.strokeColor||P.strokeStyle,t.strokeWidth||1)},this.brush.drawLineAS=function(t){rt(r(t.x1+h.x,t.y1+h.y),r(t.x2+h.x,t.y2+h.y),t.strokeColor||P.strokeStyle,t.strokeWidth||1)},this.brush.drawEllips=function(t){if(Q(t),t.x+t.w<h.x||t.x>h.x+y||t.y+t.h<h.y||t.y>h.y+a)return!1;var e=t.w/2,i=t.h/2,n=r(-h.x+t.x,-h.y+t.y);u.save(),u.translate(n.x,n.y),u.scale(e/i,1),u.translate(-n.x,-n.y),Lt(r(t.x,t.y),i,t.fillColor,t.strokeColor,t.strokeWidth),u.restore()},this.brush.drawEllipsS=function(t){if(Q(t),0>t.x+t.w||t.x>y||0>t.y+t.h||t.y>a)return!1;var e=t.w/2,i=t.h/2,n=r(t.x,t.y);u.save(),u.translate(n.x,n.y),u.scale(e/i,1),u.translate(-n.x,-n.y),Lt(r(h.x+t.x,h.y+t.y),i,t.fillColor,t.strokeColor,t.strokeWidth),u.restore()},this.brush.drawImageS=function(t){if(t.file)if(E(x[t.file])){if(x[t.file].loaded){var e=t.x||0,i=t.y||0;if(t.w&&!t.h)var n=t.w/x[t.file].w,o=t.w,c=x[t.file].h*n;else!t.w&&t.h?(n=t.h/x[t.file].h,c=t.h,o=x[t.file].w*n):t.w&&t.h?(o=t.w,c=t.h):(o=x[t.file].w,c=x[t.file].h);if(t.scale&&(o*=t.scale,c*=t.scale),0>e+o||e>y||0>i+c||i>a)return!1;u.drawImage(x[t.file].img,0,0,x[t.file].w,x[t.file].h,e,i,o,c)}}else x[t.file]={loaded:!1},e=l.document.createElement("img"),e.onload=function(){x[t.file].loaded=!0,x[t.file].img=this,x[t.file].w=this.width,x[t.file].h=this.height,T.load()},e.src=t.file,T.add()},this.brush.drawImage=function(t){if(t.file)if(E(x[t.file])){if(x[t.file].loaded){var e=t.x||0,i=t.y||0;if(t.w&&!t.h)var n=t.w/x[t.file].w,o=t.w,c=x[t.file].h*n;else!t.w&&t.h?(n=t.h/x[t.file].h,c=t.h,o=x[t.file].w*n):t.w&&t.h?(o=t.w,c=t.h):(o=x[t.file].w,c=x[t.file].h);if(t.scale&&(o*=t.scale,c*=t.scale),e+o<h.x||e>h.x+y||i+c<h.y||i>h.y+a)return!1;u.drawImage(x[t.file].img,0,0,x[t.file].w,x[t.file].h,-h.x+e,-h.y+i,o,c)}}else x[t.file]={},x[t.file].loaded=!1,e=l.document.createElement("img"),e.onload=function(){x[t.file].loaded=!0,x[t.file].img=this,x[t.file].w=this.width,x[t.file].h=this.height,T.load()},e.src=t.file,T.add()},this.brush.onContext=function(t){t(u)},this.brush.getPixelColor=function(t,e){var i=u.getImageData(t,e,1,1).data;return"rgb("+i[0]+", "+i[1]+", "+i[2]+")"},this.brush.setPixelColor=function(t,e,i){var n=u.createImageData(1,1);n.data[0]=i.r||n.data[0],n.data[1]=i.g||n.data[1],n.data[2]=i.b||n.data[2],n.data[3]=i.a||255,u.putImageData(n,t,e)},this.brush.onPixel=function(t,e,i){var n=u.getImageData(t,e,1,1),o={r:n.data[0],g:n.data[1],b:n.data[2],a:n.data[3]?n.data[3]:255};i(o),n.data[0]=o.r,n.data[1]=o.g,n.data[2]=o.b,n.data[3]=o.a,u.putImageData(n,t,e)},this.brush.onPixels=function(t,e,i,n,o){i=u.getImageData(t,e,i,n);var c;for(n=0,c=i.data.length;n<c;n+=4){var f={r:i.data[n],g:i.data[n+1],b:i.data[n+2],a:i.data[n+3]?i.data[n+3]:255};o(f),i.data[n]=f.r,i.data[n+1]=f.g,i.data[n+2]=f.b,i.data[n+3]=f.a}u.putImageData(i,t,e)},this.brush.onRawPixels=function(t,e,i,n,o){i=u.getImageData(t,e,i,n),o(i.data,i.data.length),u.putImageData(i,t,e)};var $=l.AudioContext||l.webkitAudioContext||!1;($=$?new $:!1)&&$.listener.setPosition(0,0,0);var tt=function(t,e){$||ht('module "wAudio" is not supported! use a "audio"'),this.vol=e&&1>=e&&0<e?e:1,this.loadPLay=this.nextPlay=this.loaded=this.playing=!1,this.pausedTime=this.duration=this.startTime=0;var i=this,n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(o){$.decodeAudioData(this.response,function(c){i.wABuffer=c,i.duration=i.wABuffer.duration,i.wAGain=$.createGain(),i.wAGain.gain.value=i.vol,i.wAPanner=$.createPanner(),i.wAPanner.setPosition(0,0,1),i.wAPanner.panningModel="equalpower",T.load(),i.loaded=!0,i.loadPlay&&i.replay()},function(c){ht("error in wAudio.newAudio : error decoding file",c)})},t?n.send():ht("error in wAudio.newAudio : Where is file?"),T.add()};tt.prototype.play=function(t){if(!this.loaded)this.loadPlay=!0;else if(!this.playing){this.playing=!0,this.wASource=$.createBufferSource(),this.wASource.buffer=this.wABuffer,this.wAListener=$.destination,this.wASource.connect(this.wAGain),this.wAGain.connect(this.wAPanner),this.wAPanner.connect(this.wAListener),this.wASource.start(0,this.pausedTime,this.duration),this.startTime=$.currentTime;var e=this;this.wASource.onended=function(){e.playing=!1,e.startTime=0,e.pausedTime=0,e.nextPlay&&e.nextPlay.replay()}}},tt.prototype.replay=function(t){this.loaded?(this.stop(),this.play()):this.loadPlay=!0},tt.prototype.stop=function(){this.pause(),this.pausedTime=this.startTime=0},tt.prototype.pause=function(){if(this.playing){this.pausedTime=this.getProgress(),this.playing=!1,this.wASource.stop(0);var t=this;this.wASource.onended=function(){t.playing=!1}}},tt.prototype.getProgress=function(){return this.playing?$.currentTime-this.startTime+this.pausedTime:this.pausedTime},tt.prototype.playPause=function(){this.playing?this.pause():this.play()},tt.prototype.setNextPlay=function(t){this.nextPlay=t},tt.prototype.setVolume=function(t){this.vol=t&&1>=t&&0<t?t:this.vol,this.wAGain.gain.value=this.vol},tt.prototype.getVolume=function(){return this.vol},tt.prototype.setSide=function(t){this.side=t,this.wAPanner&&this.wAPanner.setPosition(this.side,0,1-Math.abs(this.side))},tt.prototype.getSide=function(){return this.side},this.wAudio.newAudio=function(t,e){return new tt(t,e)};var lt=function(t,e){var i,n=l.document.createElement("audio");if(typeof t=="string"){var o=l.document.createElement("source");o.src=t,n.appendChild(o)}else{var c=0;for(i=t.length;c<i;c+=1)o=l.document.createElement("source"),o.src=t[c],n.appendChild(o)}this.vol=e&&1>=e&&0<e?e:1,this.playing=0,this.audio=n,this.nextPlay=this.loaded=!1,n.volume=this.vol;var f=this;n.onloadeddata=function(){f.loaded=!0,T.load()},n.onended=function(){f.playing=!1,f.nextPlay&&f.nextPlay.play()},n.load(),T.add()};lt.prototype.play=function(t){this.playing||(t&&(this.vol=t&&1>=t&&0<t?t:this.vol,this.audio.volume=this.vol),this.playing=!0,this.audio.play())},lt.prototype.replay=function(t){t&&this.setVolume(t),this.playing=!0,this.audio.currentTime=0,this.audio.play()},lt.prototype.stop=function(){this.playing&&(this.playing=!1,this.audio.pause(),this.audio.currentTime=0)},lt.prototype.pause=function(){this.playing&&(this.playing=!1,this.audio.pause())},lt.prototype.playPause=function(){this.playing?this.pause():this.play()},lt.prototype.setNextPlay=function(t){this.nextPlay=t},lt.prototype.setVolume=function(t){this.vol=t&&1>=t&&0<t?t:this.vol,this.audio.volume=this.vol},lt.prototype.getVolume=function(){return this.vol},this.audio.newAudio=function(t,e){return new lt(t,e)};var Ce=[],Dt=[];this.zList.useZValue=function(){this.update=function(){Dt.length=0,C(Ce,function(t){t.isInCamera()&&Dt.push(t)}),Dt.sort(function(t,e){return t.z-e.z})}},this.zList.useYValue=function(){this.update=function(){Dt.length=0,C(Ce,function(t){t.isInCamera()&&Dt.push(t)}),Dt.sort(function(t,e){return t.y+t.h-(e.y+e.h)})}},this.zList.add=function(t){Ce.push(t)},this.zList.init=function(t){C(t,function(e){v.zList.add(e)})},this.zList.draw=function(t){v.OOP.drawArr(Dt,t)},this.zList.del=function(t){v.OOP.delObject(Ce,t)},this.zList.useYValue();var T={count:0,loaded:0,errored:0,add:function(){this.count+=1},load:function(){this.loaded+=1},error:function(){this.errored+=1}};this.resources.isLoaded=function(){return T.count==T.loaded},this.resources.getProgress=function(){return Math.ceil(T.loaded/T.count*100)},this.levels.forStringArray=function(t,e){var i=t.offset||r(0,0);C(t.source,function(n,o){C(n,function(c,f){c!==" "&&e(c,i.x+t.w*f,i.y+t.h*o,t.w,t.h)})})};var Wi=function(t){if(t.type==="AnimationObject"&&typeof __LVL_ANIMATIONS<"u"&&t.__realAnim){var e=__LVL_ANIMATIONS[t.__realAnim];t.anim=v.tiles.newImage(e.file).getAnimation(e.x,e.y,e.w,e.h,e.frames)}var i=gi(t);return i.name="",N(t,function(n,o){o!=="id"&&o!=="anim"&&(i[o]=n)}),i},Ci=function(t,e){var i={settings:{},objects:[]};return t=JSON.parse(t),i.settings=t.settings,C(t.objects,function(n){var o=Wi(n);o.name=n.name,e&&e(o),i.objects.push(o)}),i},Ei=function(t,e,i){var n=[],o={};if(t&&e==="json"){e=Ci(t,i),n=e.objects,o=e.settings;var c=t}this.backgroundColor=o.backgroundColor?o.backgroundColor:!1,this.reload=function(){n=Ci(c)},this.clear=function(){fi(n)},this.add=function(f){n.push(f)},this.del=function(f){C(n,function(d,p){if(f===d)return n.splice(p,1),"break"})},this.delById=function(f){n.splice(f,1)},this.getObjects=function(){return n},this.getObjectByName=function(f){var d,p=0;for(d=n.length;p<d;p+=1)if(n[p].name==f)return n[p];return!1},this.getObjectById=function(f){var d,p=0;for(d=n.length;p<d;p+=1)if(n[p].id==f)return n[p];return!1},this.draw=function(f){this.backgroundColor&&v.game.fill(this.backgroundColor),C(n,function(d){f&&f(d),d.isInCamera()&&d.draw()})},this.getObjectsInCamera=function(){var f=[];return C(n,function(d){d.isInCamera()&&f.push(d)}),f},this.getLevelAsJSON=function(f,d){var p='{"settings":'+JSON.stringify({backgroundColor:this.backgroundColor})+',"objects":[';return n.length&&(C(n,function(S,k){f&&f(S),p+="{",N(S,function(I,j){typeof I!="function"&&(p+='"'+j+'":'+JSON.stringify(I)+",")}),p=p.substr(0,p.length-1)+"},",d&&d(S)}),p=p.substr(0,p.length-1)),p+"]}"}};this.levels.newLevelFromJSON=function(t,e){return new Ei(t,"json",e||!1)},this.levels.newEmptyLevel=function(t){return new Ei(!1)};var ki=0,Ai=0,He=0,Mi=!1;this.system.initFPSCheck=function(){Mi||(Mi=!0,m.addEvent("postLoop","fpsCheckUpdate",function(){He+=1,1e3<=X-Ai&&(ki=He,He=0,Ai=X)}))},this.system.getFPS=function(){return ki};var Ee=this.filters;Ee.setCSSFilter=function(t,e){var i=(e?e.canvas:g).style,n="";N(t,function(o,c){n+=" "+c+"("+o+")"}),i.OFilter=i.MozFilter=i.WebkitFilter=i.filter=n},Ee.clearCSSFilter=function(t){t=(t?t.canvas:g).style,t.OFilter=t.MozFilter=t.WebkitFilter=t.filter="none"},Ee.setCSSTransform=function(t,e){var i=(e?e.canvas:g).style,n="perspective("+y+"px)";N(t,function(o,c){n+=" "+c+"("+o+")"}),i.transform=i.MozTransform=i.WebkitTransform=n},Ee.clearCSSTransform=function(t){t=(t?t.canvas:g).style,t.transform=t.MozTransform=t.WebkitTransform="none"};var s=this.presets;s.key={NAME:null,keyMoveDX:0,keyMoveDY:0,p:0},s.keyMoveInit=function(t,e,i,n,o,c){s.key.NAME=t,s.key.SPEED=e,s.key.keyMoveDX=0,s.key.keyMoveDY=0,s.key.p=pjs.vector.point,t=pjs.keyControl.isDown,s.key.keyMoveDX=s.key.keyMoveDY=0,i?t(i)&&(s.key.keyMoveDX=s.key.SPEED||1):(t("D")||t("RIGHT"))&&(s.key.keyMoveDX=s.key.SPEED||1),n?t(n)&&(s.key.keyMoveDX=-s.key.SPEED||-1):(t("A")||t("LEFT"))&&(s.key.keyMoveDX=-s.key.SPEED||-1),o?t(o)&&(s.key.keyMoveDY=-s.key.SPEED||-1):(t("W")||t("UP"))&&(s.key.keyMoveDY=-s.key.SPEED||-1),c?t(c)&&(s.key.keyMoveDY=s.key.SPEED||1):(t("S")||t("DOWN"))&&(s.key.keyMoveDY=s.key.SPEED||1)},s.keyMoveCollision=function(t){t.isStaticIntersect(s.key.NAME.getStaticBoxD(0,0,s.key.SPEED))&&s.key.keyMoveDX==s.key.SPEED&&(s.key.keyMoveDX=0,s.key.NAME.x=t.x-s.key.NAME.w),t.isStaticIntersect(s.key.NAME.getStaticBoxA(-s.key.SPEED,0,s.key.SPEED))&&s.key.keyMoveDX==-s.key.SPEED&&(s.key.keyMoveDX=0,s.key.NAME.x=t.x+t.w),t.isStaticIntersect(s.key.NAME.getStaticBoxW(0,-s.key.SPEED,0,s.key.SPEED))&&s.key.keyMoveDY==-s.key.SPEED&&(s.key.keyMoveDY=0,s.key.NAME.y=t.y+t.h),t.isStaticIntersect(s.key.NAME.getStaticBoxS(0,0,0,s.key.SPEED))&&s.key.keyMoveDY==s.key.SPEED&&(s.key.keyMoveDY=0,s.key.NAME.y=t.y-s.key.NAME.h)},s.keyMove=function(){s.key.NAME.move(s.key.p(s.key.keyMoveDX,s.key.keyMoveDY))},s.mouse={mouseMoveDX:0,mouseMoveDY:0,mouseX:1,mouseY:1,POINT:0,TYPE:1,SPEED:1,TRACKING:0,NAME:null,FLAG1:!1,FLAG2:!1,mouseControl:null,getPosition:null},s.mouseMoveInit=function(t,e,i,n){s.mouse.TYPE=i,s.mouse.SPEED=e,s.mouse.TRACKING=n,s.mouse.NAME=t,s.mouse.FLAG1=!1,s.mouse.FLAG2=!1,s.mouse.mouseControl=pjs.mouseControl,s.mouse.getPosition=s.mouse.mouseControl.getPosition(),t=pjs.mouseControl,s.mouse.TRACKING==1&&s.mouse.NAME.rotate(s.mouse.getPosition),(s.mouse.TYPE==1||s.mouse.TYPE==2)&&(s.mouse.POINT=s.mouse.getPosition,s.mouse.getPosition.x>s.mouse.NAME.getPositionC().x?(s.mouse.mouseMoveDX=s.mouse.SPEED,s.mouse.mouseX=1):s.mouse.getPosition.x<s.mouse.NAME.getPositionC().x&&(s.mouse.mouseMoveDX=-s.mouse.SPEED,s.mouse.mouseX=1),s.mouse.getPosition.y<s.mouse.NAME.getPositionC().y?(s.mouse.mouseMoveDY=-s.mouse.SPEED,s.mouse.mouseY=1):s.mouse.getPosition.y>s.mouse.NAME.getPositionC().y&&(s.mouse.mouseMoveDY=s.mouse.SPEED,s.mouse.mouseY=1)),(s.mouse.TYPE==3||s.mouse.TYPE==4||s.mouse.TYPE==5)&&(t.isPress("LEFT")&&(s.mouse.POINT=s.mouse.getPosition,s.mouse.TRACKING==1&&s.mouse.NAME.rotate(s.mouse.getPosition),s.mouse.getPosition.x>s.mouse.NAME.getPositionC().x?(s.mouse.mouseMoveDX=s.mouse.SPEED,s.mouse.mouseX=1):s.mouse.getPosition.x<s.mouse.NAME.getPositionC().x&&(s.mouse.mouseMoveDX=-s.mouse.SPEED,s.mouse.mouseX=1),s.mouse.getPosition.y<s.mouse.NAME.getPositionC().y?(s.mouse.mouseMoveDY=-s.mouse.SPEED,s.mouse.mouseY=1):s.mouse.getPosition.y>s.mouse.NAME.getPositionC().y&&(s.mouse.mouseMoveDY=s.mouse.SPEED,s.mouse.mouseY=1)),s.mouse.TYPE==5&&(s.mouse.FLAG1==0&&s.mouse.mouseX==0?s.mouse.mouseX=1:s.mouse.FLAG2==0&&s.mouse.mouseY==0&&(s.mouse.mouseY=1)))},s.mouseMoveCollision=function(t){t.isStaticIntersect(s.mouse.NAME.getStaticBoxD(0,0,s.mouse.SPEED))&&s.mouse.mouseX==1&&s.mouse.mouseMoveDX==s.mouse.SPEED&&(s.mouse.FLAG1=!0,s.mouse.mouseX=0,s.mouse.TYPE==2&&(s.mouse.mouseY=0),s.mouse.NAME.x=t.x-s.mouse.NAME.w,s.mouse.TYPE==4&&(s.mouse.POINT=0)),t.isStaticIntersect(s.mouse.NAME.getStaticBoxA(-s.mouse.SPEED,0,s.mouse.SPEED))&&s.mouse.mouseX==1&&s.mouse.mouseMoveDX==-s.mouse.SPEED&&(s.mouse.FLAG1=!0,s.mouse.mouseX=0,s.mouse.TYPE==2&&(s.mouse.mouseY=0),s.mouse.NAME.x=t.x+t.w,s.mouse.TYPE==4&&(s.mouse.POINT=0)),t.isStaticIntersect(s.mouse.NAME.getStaticBoxW(0,-s.mouse.SPEED,0,s.mouse.SPEED))&&s.mouse.mouseY==1&&s.mouse.mouseMoveDY==-s.mouse.SPEED&&(s.mouse.FLAG2=!0,s.mouse.mouseY=0,s.mouse.TYPE==2&&(s.mouse.mouseX=0),s.mouse.NAME.y=t.y+t.h,s.mouse.TYPE==4&&(s.mouse.POINT=0)),t.isStaticIntersect(s.mouse.NAME.getStaticBoxS(0,0,0,s.mouse.SPEED))&&s.mouse.mouseY==1&&s.mouse.mouseMoveDY==s.mouse.SPEED&&(s.mouse.FLAG2=!0,s.mouse.mouseY=0,s.mouse.TYPE==2&&(s.mouse.mouseX=0),s.mouse.NAME.y=t.y-s.mouse.NAME.h,s.mouse.TYPE==4&&(s.mouse.POINT=0))},s.mouseMove=function(){s.mouse.NAME.getDistanceC(s.mouse.POINT)>s.mouse.SPEED+1&&s.mouse.NAME.moveToC(s.mouse.POINT,s.mouse.SPEED*s.mouse.mouseX,s.mouse.SPEED*s.mouse.mouseY)},s.bgCycle=function(t,e,i,n,o){var c=pjs.vector.point;if(e!=0)var f=game.newImageObject({x:0>e?t.x+t.w+e+(n||0):t.x-t.w+e+(n||0),y:t.y,file:t.file});if(i!=0)var d=game.newImageObject({x:t.x,y:0>i?t.y+t.h+i+(o||0):t.y-t.h+i+(o||0),file:t.file});e!=0&&(0>e?0>t.x+t.w&&(t.x=0):0<e&&0<t.x-t.w&&(t.x=0)),i!=0&&(0>i?0>t.y+t.h+i&&(t.y=0):0<i&&t.y>t.h&&(t.y=0)),t.move(c(e,i)),e!=0&&f.draw(),i!=0&&d.draw()},s.physics={NAME:null,keyMoveDX:0,keyMoveDY:0,SPEED:0,GRAVITY:0,DENSITY:0,BOUNCE:0,STICKING:0,minBounce:0,m:0,flag1:!0,GG:0,p:0,memoryDY:0,ROTATION:0,rtStop:0,ACCELETARIONDOWN:0},s.physicsMoveInit=function(t,e,i,n,o,c,f,d,p,S,k,I,j,L){s.physics.NAME=t,s.physics.SPEED=e,s.physics.GRAVITY=i,s.physics.DENSITY=n,s.physics.rtStop=p,s.physics.BOUNCE=o,s.physics.BOUNCE!=0&&2.4>=s.physics.BOUNCE&&(s.physics.BOUNCE=2.4),s.physics.STICKING=c,s.physics.minBounce=f,s.physics.ACCELETARIONDOWN=S,t=pjs.keyControl.isDown,c=pjs.mouseControl.isPress,s.physics.p=pjs.vector.point,s.physics.keyMoveDX=0,s.physics.ROTATION=0,(t(k[0])||t(k[1])||t(k[2])||t(k[3])||t(k[4])||t(k[5]))&&(s.physics.keyMoveDX=e,d!=0&&(s.physics.ROTATION=d)),(t(I[0])||t(I[1])||t(I[2])||t(I[3])||t(I[4])||t(I[5]))&&(s.physics.keyMoveDX=-e,d!=0&&(s.physics.ROTATION=-d)),(t(j[0])||t(j[1])||t(j[2])||t(j[3])||t(j[4])||t(j[5])||c(L[0])||c(L[1])||c(L[2]))&&s.physics.flag1==0&&(s.physics.GG=i,s.physics.BOUNCE=o,s.physics.memoryDY=0,s.physics.keyMoveDY=0,s.physics.flag1=!0),s.physics.keyMoveDY-=n,s.physics.GG+=s.physics.keyMoveDY,s.physics.NAME.y-=s.physics.GG},s.physicsMoveCollision=function(t){0>s.physics.GG&&t.isStaticIntersect(s.physics.NAME.getStaticBoxS(0,-s.physics.keyMoveDY+1,0,0))&&(s.physics.NAME.y=t.y-s.physics.NAME.h,s.physics.m=Math.abs(s.physics.GG),s.physics.keyMoveDY=0,s.physics.GG=0,s.physics.BOUNCE!=0&&s.physics.m>s.physics.minBounce&&(s.physics.GG=s.physics.m/s.physics.BOUNCE),s.physics.GG==0&&s.physics.keyMoveDY==0&&s.physics.flag1==1&&(s.physics.memoryDY=s.physics.NAME.y,s.physics.flag1=!1),s.physics.flag1==0&&(s.physics.GG=s.physics.ACCELETARIONDOWN)),0<s.physics.GG&&t.isStaticIntersect(s.physics.NAME.getStaticBoxW(0,-s.physics.keyMoveDY,1,s.physics.ACCELETARIONDOWN))&&(s.physics.NAME.y=t.y+t.h,s.physics.GG=0,s.physics.STICKING!=0&&(s.physics.keyMoveDY=s.physics.STICKING)),t.isStaticIntersect(s.physics.NAME.getStaticBoxA(s.physics.keyMoveDX,0,-s.physics.keyMoveDX,0))&&s.physics.keyMoveDX==-s.physics.SPEED?(s.physics.keyMoveDX=0,s.physics.NAME.x=t.x+t.w,s.physics.rtStop==1&&(s.physics.ROTATION=0)):t.isStaticIntersect(s.physics.NAME.getStaticBoxD(0,0,s.physics.keyMoveDX,s.physics.ACCELETARIONDOWN))&&s.physics.keyMoveDX==s.physics.SPEED&&(s.physics.keyMoveDX=0,s.physics.NAME.x=t.x-s.physics.NAME.w,s.physics.rtStop==1&&(s.physics.ROTATION=0))},s.physicsMove=function(){s.physics.NAME.move(s.physics.p(s.physics.keyMoveDX,s.physics.keyMoveDY)),s.physics.NAME.turn(s.physics.ROTATION),s.physics.memoryDY!=0&&s.physics.NAME.y>s.physics.memoryDY&&s.physics.flag1==0&&(s.physics.memoryDY=0,s.physics.flag1=!0)},this.OOP.newRever=function(t,e,i){var n=function(o,c,f){this.min=o,this.max=c,this.step=f,this.value=o,this.to=f};return n.prototype={update:function(){var o=this.value;return this.value<=this.min?this.to=this.step:this.value>=this.max&&(this.to=-this.step),this.value+=this.to,o},getValue:function(){return this.value},setValue:function(o){this.value=parseFloat(o)},setStep:function(o){this.step=o},getStep:function(){return this.step}},new n(t,e,i)};var Oi={};this.OOP.once=function(t,e){Oi[t]||(Oi[t]=!0,e())},this.OOP.newTimer=function(t,e){if(0>=t)return at("error in system.newTimer : variable < 0, Timer is not created");var i={time:0<t?t:1e3,func:e,startTime:!1,ending:!1,start:function(){this.ending||this.startTime||(this.startTime=X)},run:function(){!this.ending&&this.startTime&&X-this.startTime>=this.time&&(this.func(),this.ending=!0)},end:function(){this.ending||(this.ending=!0,this.func())},restart:function(n){if(this.startTime||this.start(),this.ending){if(n&&0>=n)return at("error in Timer.restart : variable < 0");n&&(this.time=n),this.ending=!1,this.startTime=X}},stop:function(){this.ending||(this.ending=!0)}};return m.addEvent("postLoop","timer"+K(-100,100)*K(-100,100)+X,function(){i.run()}),i},this.memory.local={storage:l.localStorage,clear:function(){this.storage.clear()},save:function(t,e){this.storage.setItem(t,e)},saveAsObject:function(t,e){var i=JSON.stringify(e);this.storage.setItem(t,i)},loadAsObject:function(t){return JSON.parse(this.storage.getItem(t)||"false")},load:function(t){return this.storage.getItem(t)},loadAsNumber:function(t){return parseFloat(this.storage.getItem(t))}},this.memory.temp={values:{},save:function(t,e){this.values[t]=e},load:function(t){return this.values[t]},loadAsNumber:function(t){return parseFloat(this.values[t])}},l.addEventListener("load",function(){if(u){for(var t in P)u[t]=P[t];u.save()}return m.runEvent("onload"),m.loaded=!0,F||(l.document.body.style.overflow="hidden"),typeof POINTJS_USER_ONLOAD=="function"&&POINTJS_USER_ONLOAD(),!1}),l.addEventListener("blur",function(){if(ft)return m.runEvent("gameBlur"),!1}),l.addEventListener("focus",function(){if(!ft)return l.document.activeElement.blur(),l.focus(),m.runEvent("gameFocus"),!1}),l.addEventListener("resize",function(){return m.runEvent("gameResize"),u&&(u.textBaseline=P.textBaseline,y/=wt,a/=vt,R=y/2,J=a/2,u.scale(wt,vt)),!1}),(F?w:l).addEventListener("click",function(){l.document.activeElement&&l.document.activeElement.blur(),l.focus()}),typeof POINTJS_LOADED_DOM_IGNORE<"u"&&l.onload(),typeof POINTJS_ENGINE_CREATED_EVENT<"u"&&POINTJS_ENGINE_CREATED_EVENT(this),l._GLOGAL_POINT_JS=this}const _i="/template-pointjs/assets/logo-799b9185.png";class Xi{constructor(Y){this.obj=Y.newImageObject({file:_i,x:90,y:40,w:400,h:400})}render(){this.obj.turn(1),this.obj.draw()}}(function(){const Y=new Gi(680,480,{}).game,pt=new Xi(Y);Y.newLoop("game",()=>{pt.render()}),Y.setLoop("game"),Y.start()})();
